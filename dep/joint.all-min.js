/**
 * Joint 0.2 - JavaScript diagramming library.
 * Copyright (c) David Durman 2009 - 2010
 * Licensed under the MIT license: (http://www.opensource.org/licenses/mit-license.php)
 */
/*
 * Raphael 1.3.1 - JavaScript Vector Library
 *
 * Copyright (c) 2008 - 2009 Dmitry Baranovskiy (http://raphaeljs.com)
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 */
Raphael=(function(){var a=/[, ]+/,aO=/^(circle|rect|path|ellipse|text|image)$/,L=document,au=window,l={was:"Raphael" in au,is:au.Raphael},an=function(){if(an.is(arguments[0],"array")){var d=arguments[0],e=w[aW](an,d.splice(0,3+an.is(d[0],al))),S=e.set();for(var R=0,a0=d[m];R<a0;R++){var E=d[R]||{};aO.test(E.type)&&S[f](e[E.type]().attr(E));}return S;}return w[aW](an,arguments);},aT=function(){},aL="appendChild",aW="apply",aS="concat",at="",am=" ",z="split",F="click dblclick mousedown mousemove mouseout mouseover mouseup"[z](am),Q="hasOwnProperty",az="join",m="length",aY="prototype",aZ=String[aY].toLowerCase,ab=Math,g=ab.max,aI=ab.min,al="number",aA="toString",aw=Object[aY][aA],aQ={},aM=ab.pow,f="push",aU=/^(?=[\da-f]$)/,c=/^url\(['"]?([^\)]+)['"]?\)$/i,x=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgb\(\s*([\d\.]+\s*,\s*[\d\.]+\s*,\s*[\d\.]+)\s*\)|rgb\(\s*([\d\.]+%\s*,\s*[\d\.]+%\s*,\s*[\d\.]+%)\s*\)|hs[bl]\(\s*([\d\.]+\s*,\s*[\d\.]+\s*,\s*[\d\.]+)\s*\)|hs[bl]\(\s*([\d\.]+%\s*,\s*[\d\.]+%\s*,\s*[\d\.]+%)\s*\))\s*$/i,O=ab.round,v="setAttribute",W=parseFloat,G=parseInt,aN=String[aY].toUpperCase,j={"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/",opacity:1,path:"M0,0",r:0,rotation:0,rx:0,ry:0,scale:"1 1",src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",translation:"0 0",width:0,x:0,y:0},Z={along:"along","clip-rect":"csv",cx:al,cy:al,fill:"colour","fill-opacity":al,"font-size":al,height:al,opacity:al,path:"path",r:al,rotation:"csv",rx:al,ry:al,scale:"csv",stroke:"colour","stroke-opacity":al,"stroke-width":al,translation:"csv",width:al,x:al,y:al},aP="replace";an.version="1.3.1";an.type=(au.SVGAngle||L.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML");if(an.type=="VML"){var ag=document.createElement("div");ag.innerHTML="<!--[if vml]><br><br><![endif]-->";if(ag.childNodes[m]!=2){return null;}}an.svg=!(an.vml=an.type=="VML");aT[aY]=an[aY];an._id=0;an._oid=0;an.fn={};an.is=function(e,d){d=aZ.call(d);return((d=="object"||d=="undefined")&&typeof e==d)||(e==null&&d=="null")||aZ.call(aw.call(e).slice(8,-1))==d;};an.setWindow=function(d){au=d;L=au.document;};var aD=function(e){if(an.vml){var d=/^\s+|\s+$/g;aD=aj(function(R){var S;R=(R+at)[aP](d,at);try{var a0=new ActiveXObject("htmlfile");a0.write("<body>");a0.close();S=a0.body;}catch(a2){S=createPopup().document.body;}var i=S.createTextRange();try{S.style.color=R;var a1=i.queryCommandValue("ForeColor");a1=((a1&255)<<16)|(a1&65280)|((a1&16711680)>>>16);return"#"+("000000"+a1[aA](16)).slice(-6);}catch(a2){return"none";}});}else{var E=L.createElement("i");E.title="Rapha\xebl Colour Picker";E.style.display="none";L.body[aL](E);aD=aj(function(i){E.style.color=i;return L.defaultView.getComputedStyle(E,at).getPropertyValue("color");});}return aD(e);};an.hsb2rgb=aj(function(a3,a1,a7){if(an.is(a3,"object")&&"h" in a3&&"s" in a3&&"b" in a3){a7=a3.b;a1=a3.s;a3=a3.h;}var R,S,a8;if(a7==0){return{r:0,g:0,b:0,hex:"#000"};}if(a3>1||a1>1||a7>1){a3/=255;a1/=255;a7/=255;}var a0=~~(a3*6),a4=(a3*6)-a0,E=a7*(1-a1),e=a7*(1-(a1*a4)),a9=a7*(1-(a1*(1-a4)));R=[a7,e,E,E,a9,a7,a7][a0];S=[a9,a7,a7,e,E,E,a9][a0];a8=[E,E,a9,a7,a7,e,E][a0];R*=255;S*=255;a8*=255;var a5={r:R,g:S,b:a8},d=(~~R)[aA](16),a2=(~~S)[aA](16),a6=(~~a8)[aA](16);d=d[aP](aU,"0");a2=a2[aP](aU,"0");a6=a6[aP](aU,"0");a5.hex="#"+d+a2+a6;return a5;},an);an.rgb2hsb=aj(function(d,e,a1){if(an.is(d,"object")&&"r" in d&&"g" in d&&"b" in d){a1=d.b;e=d.g;d=d.r;}if(an.is(d,"string")){var a3=an.getRGB(d);d=a3.r;e=a3.g;a1=a3.b;}if(d>1||e>1||a1>1){d/=255;e/=255;a1/=255;}var a0=g(d,e,a1),i=aI(d,e,a1),R,E,S=a0;if(i==a0){return{h:0,s:0,b:a0};}else{var a2=(a0-i);E=a2/a0;if(d==a0){R=(e-a1)/a2;}else{if(e==a0){R=2+((a1-d)/a2);}else{R=4+((d-e)/a2);}}R/=6;R<0&&R++;R>1&&R--;}return{h:R,s:E,b:S};},an);var aE=/,?([achlmqrstvxz]),?/gi;an._path2string=function(){return this.join(",")[aP](aE,"$1");};function aj(E,e,d){function i(){var R=Array[aY].slice.call(arguments,0),a0=R[az]("\u25ba"),S=i.cache=i.cache||{},a1=i.count=i.count||[];if(S[Q](a0)){return d?d(S[a0]):S[a0];}a1[m]>=1000&&delete S[a1.shift()];a1[f](a0);S[a0]=E[aW](e,R);return d?d(S[a0]):S[a0];}return i;}an.getRGB=aj(function(d){if(!d||!!((d=d+at).indexOf("-")+1)){return{r:-1,g:-1,b:-1,hex:"none",error:1};}if(d=="none"){return{r:-1,g:-1,b:-1,hex:"none"};}!(({hs:1,rg:1})[Q](d.substring(0,2))||d.charAt()=="#")&&(d=aD(d));var S,i,E,a2,a3,a0=d.match(x);if(a0){if(a0[2]){a2=G(a0[2].substring(5),16);E=G(a0[2].substring(3,5),16);i=G(a0[2].substring(1,3),16);}if(a0[3]){a2=G((a3=a0[3].charAt(3))+a3,16);E=G((a3=a0[3].charAt(2))+a3,16);i=G((a3=a0[3].charAt(1))+a3,16);}if(a0[4]){a0=a0[4][z](/\s*,\s*/);i=W(a0[0]);E=W(a0[1]);a2=W(a0[2]);}if(a0[5]){a0=a0[5][z](/\s*,\s*/);i=W(a0[0])*2.55;E=W(a0[1])*2.55;a2=W(a0[2])*2.55;}if(a0[6]){a0=a0[6][z](/\s*,\s*/);i=W(a0[0]);E=W(a0[1]);a2=W(a0[2]);return an.hsb2rgb(i,E,a2);}if(a0[7]){a0=a0[7][z](/\s*,\s*/);i=W(a0[0])*2.55;E=W(a0[1])*2.55;a2=W(a0[2])*2.55;return an.hsb2rgb(i,E,a2);}a0={r:i,g:E,b:a2};var e=(~~i)[aA](16),R=(~~E)[aA](16),a1=(~~a2)[aA](16);e=e[aP](aU,"0");R=R[aP](aU,"0");a1=a1[aP](aU,"0");a0.hex="#"+e+R+a1;return a0;}return{r:-1,g:-1,b:-1,hex:"none",error:1};},an);an.getColor=function(e){var i=this.getColor.start=this.getColor.start||{h:0,s:1,b:e||0.75},d=this.hsb2rgb(i.h,i.s,i.b);i.h+=0.075;if(i.h>1){i.h=0;i.s-=0.2;i.s<=0&&(this.getColor.start={h:0,s:1,b:i.b});}return d.hex;};an.getColor.reset=function(){delete this.start;};an.parsePathString=aj(function(d){if(!d){return null;}var i={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},e=[];if(an.is(d,"array")&&an.is(d[0],"array")){e=av(d);}if(!e[m]){(d+at)[aP](/([achlmqstvz])[\s,]*((-?\d*\.?\d*(?:e[-+]?\d+)?\s*,?\s*)+)/ig,function(R,E,a1){var a0=[],S=aZ.call(E);a1[aP](/(-?\d*\.?\d*(?:e[-+]?\d+)?)\s*,?\s*/ig,function(a3,a2){a2&&a0[f](+a2);});while(a0[m]>=i[S]){e[f]([E][aS](a0.splice(0,i[S])));if(!i[S]){break;}}});}e[aA]=an._path2string;return e;});an.findDotsAtSegment=function(e,d,be,bc,a0,R,a2,a1,a8){var a6=1-a8,a5=aM(a6,3)*e+aM(a6,2)*3*a8*be+a6*3*a8*a8*a0+aM(a8,3)*a2,a3=aM(a6,3)*d+aM(a6,2)*3*a8*bc+a6*3*a8*a8*R+aM(a8,3)*a1,ba=e+2*a8*(be-e)+a8*a8*(a0-2*be+e),a9=d+2*a8*(bc-d)+a8*a8*(R-2*bc+d),bd=be+2*a8*(a0-be)+a8*a8*(a2-2*a0+be),bb=bc+2*a8*(R-bc)+a8*a8*(a1-2*R+bc),a7=(1-a8)*e+a8*be,a4=(1-a8)*d+a8*bc,E=(1-a8)*a0+a8*a2,i=(1-a8)*R+a8*a1,S=(90-ab.atan((ba-bd)/(a9-bb))*180/ab.PI);(ba>bd||a9<bb)&&(S+=180);return{x:a5,y:a3,m:{x:ba,y:a9},n:{x:bd,y:bb},start:{x:a7,y:a4},end:{x:E,y:i},alpha:S};};var U=aj(function(a5){if(!a5){return{x:0,y:0,width:0,height:0};}a5=H(a5);var a2=0,a1=0,R=[],e=[],E;for(var S=0,a4=a5[m];S<a4;S++){E=a5[S];if(E[0]=="M"){a2=E[1];a1=E[2];R[f](a2);e[f](a1);}else{var a0=aC(a2,a1,E[1],E[2],E[3],E[4],E[5],E[6]);R=R[aS](a0.min.x,a0.max.x);e=e[aS](a0.min.y,a0.max.y);a2=E[5];a1=E[6];}}var d=aI[aW](0,R),a3=aI[aW](0,e);return{x:d,y:a3,width:g[aW](0,R)-d,height:g[aW](0,e)-a3};}),av=function(a0){var E=[];if(!an.is(a0,"array")||!an.is(a0&&a0[0],"array")){a0=an.parsePathString(a0);}for(var e=0,R=a0[m];e<R;e++){E[e]=[];for(var d=0,S=a0[e][m];d<S;d++){E[e][d]=a0[e][d];}}E[aA]=an._path2string;return E;},ad=aj(function(R){if(!an.is(R,"array")||!an.is(R&&R[0],"array")){R=an.parsePathString(R);}var a4=[],a6=0,a5=0,a9=0,a8=0,E=0;if(R[0][0]=="M"){a6=R[0][1];a5=R[0][2];a9=a6;a8=a5;E++;a4[f](["M",a6,a5]);}for(var a1=E,ba=R[m];a1<ba;a1++){var d=a4[a1]=[],a7=R[a1];if(a7[0]!=aZ.call(a7[0])){d[0]=aZ.call(a7[0]);switch(d[0]){case"a":d[1]=a7[1];d[2]=a7[2];d[3]=a7[3];d[4]=a7[4];d[5]=a7[5];d[6]=+(a7[6]-a6).toFixed(3);d[7]=+(a7[7]-a5).toFixed(3);break;case"v":d[1]=+(a7[1]-a5).toFixed(3);break;case"m":a9=a7[1];a8=a7[2];default:for(var a0=1,a2=a7[m];a0<a2;a0++){d[a0]=+(a7[a0]-((a0%2)?a6:a5)).toFixed(3);}}}else{d=a4[a1]=[];if(a7[0]=="m"){a9=a7[1]+a6;a8=a7[2]+a5;}for(var S=0,e=a7[m];S<e;S++){a4[a1][S]=a7[S];}}var a3=a4[a1][m];switch(a4[a1][0]){case"z":a6=a9;a5=a8;break;case"h":a6+=+a4[a1][a3-1];break;case"v":a5+=+a4[a1][a3-1];break;default:a6+=+a4[a1][a3-2];a5+=+a4[a1][a3-1];}}a4[aA]=an._path2string;return a4;},0,av),r=aj(function(R){if(!an.is(R,"array")||!an.is(R&&R[0],"array")){R=an.parsePathString(R);}var a3=[],a5=0,a4=0,a8=0,a7=0,E=0;if(R[0][0]=="M"){a5=+R[0][1];a4=+R[0][2];a8=a5;a7=a4;E++;a3[0]=["M",a5,a4];}for(var a1=E,a9=R[m];a1<a9;a1++){var d=a3[a1]=[],a6=R[a1];if(a6[0]!=aN.call(a6[0])){d[0]=aN.call(a6[0]);switch(d[0]){case"A":d[1]=a6[1];d[2]=a6[2];d[3]=a6[3];d[4]=a6[4];d[5]=a6[5];d[6]=+(a6[6]+a5);d[7]=+(a6[7]+a4);break;case"V":d[1]=+a6[1]+a4;break;case"H":d[1]=+a6[1]+a5;break;case"M":a8=+a6[1]+a5;a7=+a6[2]+a4;default:for(var a0=1,a2=a6[m];a0<a2;a0++){d[a0]=+a6[a0]+((a0%2)?a5:a4);}}}else{for(var S=0,e=a6[m];S<e;S++){a3[a1][S]=a6[S];}}switch(d[0]){case"Z":a5=a8;a4=a7;break;case"H":a5=d[1];break;case"V":a4=d[1];break;default:a5=a3[a1][a3[a1][m]-2];a4=a3[a1][a3[a1][m]-1];}}a3[aA]=an._path2string;return a3;},null,av),aX=function(e,E,d,i){return[e,E,d,i,d,i];},aK=function(e,E,a0,R,d,i){var S=1/3,a1=2/3;return[S*e+a1*a0,S*E+a1*R,S*d+a1*a0,S*i+a1*R,d,i];},K=function(a9,bE,bi,bg,ba,a4,S,a8,bD,bb){var R=ab.PI,bf=R*120/180,d=R/180*(+ba||0),bm=[],bj,bA=aj(function(bF,bI,i){var bH=bF*ab.cos(i)-bI*ab.sin(i),bG=bF*ab.sin(i)+bI*ab.cos(i);return{x:bH,y:bG};});if(!bb){bj=bA(a9,bE,-d);a9=bj.x;bE=bj.y;bj=bA(a8,bD,-d);a8=bj.x;bD=bj.y;var e=ab.cos(R/180*ba),a6=ab.sin(R/180*ba),bo=(a9-a8)/2,bn=(bE-bD)/2;bi=g(bi,ab.abs(bo));bg=g(bg,ab.abs(bn));var by=(bo*bo)/(bi*bi)+(bn*bn)/(bg*bg);if(by>1){bi=ab.sqrt(by)*bi;bg=ab.sqrt(by)*bg;}var E=bi*bi,br=bg*bg,bt=(a4==S?-1:1)*ab.sqrt(ab.abs((E*br-E*bn*bn-br*bo*bo)/(E*bn*bn+br*bo*bo))),bd=bt*bi*bn/bg+(a9+a8)/2,bc=bt*-bg*bo/bi+(bE+bD)/2,a3=ab.asin(((bE-bc)/bg).toFixed(7)),a2=ab.asin(((bD-bc)/bg).toFixed(7));a3=a9<bd?R-a3:a3;a2=a8<bd?R-a2:a2;a3<0&&(a3=R*2+a3);a2<0&&(a2=R*2+a2);if(S&&a3>a2){a3=a3-R*2;}if(!S&&a2>a3){a2=a2-R*2;}}else{a3=bb[0];a2=bb[1];bd=bb[2];bc=bb[3];}var a7=a2-a3;if(ab.abs(a7)>bf){var be=a2,bh=a8,a5=bD;a2=a3+bf*(S&&a2>a3?1:-1);a8=bd+bi*ab.cos(a2);bD=bc+bg*ab.sin(a2);bm=K(a8,bD,bi,bg,ba,0,S,bh,a5,[a2,be,bd,bc]);}a7=a2-a3;var a1=ab.cos(a3),bC=ab.sin(a3),a0=ab.cos(a2),bB=ab.sin(a2),bp=ab.tan(a7/4),bs=4/3*bi*bp,bq=4/3*bg*bp,bz=[a9,bE],bx=[a9+bs*bC,bE-bq*a1],bw=[a8+bs*bB,bD-bq*a0],bu=[a8,bD];bx[0]=2*bz[0]-bx[0];bx[1]=2*bz[1]-bx[1];if(bb){return[bx,bw,bu][aS](bm);}else{bm=[bx,bw,bu][aS](bm)[az]()[z](",");var bk=[];for(var bv=0,bl=bm[m];bv<bl;bv++){bk[bv]=bv%2?bA(bm[bv-1],bm[bv],d).y:bA(bm[bv],bm[bv+1],d).x;}return bk;}},M=function(e,d,E,i,a2,a1,a0,S,a3){var R=1-a3;return{x:aM(R,3)*e+aM(R,2)*3*a3*E+R*3*a3*a3*a2+aM(a3,3)*a0,y:aM(R,3)*d+aM(R,2)*3*a3*i+R*3*a3*a3*a1+aM(a3,3)*S};},aC=aj(function(i,d,R,E,a9,a8,a5,a2){var a7=(a9-2*R+i)-(a5-2*a9+R),a4=2*(R-i)-2*(a9-R),a1=i-R,a0=(-a4+ab.sqrt(a4*a4-4*a7*a1))/2/a7,S=(-a4-ab.sqrt(a4*a4-4*a7*a1))/2/a7,a3=[d,a2],a6=[i,a5],e;ab.abs(a0)>1000000000000&&(a0=0.5);ab.abs(S)>1000000000000&&(S=0.5);if(a0>0&&a0<1){e=M(i,d,R,E,a9,a8,a5,a2,a0);a6[f](e.x);a3[f](e.y);}if(S>0&&S<1){e=M(i,d,R,E,a9,a8,a5,a2,S);a6[f](e.x);a3[f](e.y);}a7=(a8-2*E+d)-(a2-2*a8+E);a4=2*(E-d)-2*(a8-E);a1=d-E;a0=(-a4+ab.sqrt(a4*a4-4*a7*a1))/2/a7;S=(-a4-ab.sqrt(a4*a4-4*a7*a1))/2/a7;ab.abs(a0)>1000000000000&&(a0=0.5);ab.abs(S)>1000000000000&&(S=0.5);if(a0>0&&a0<1){e=M(i,d,R,E,a9,a8,a5,a2,a0);a6[f](e.x);a3[f](e.y);}if(S>0&&S<1){e=M(i,d,R,E,a9,a8,a5,a2,S);a6[f](e.x);a3[f](e.y);}return{min:{x:aI[aW](0,a6),y:aI[aW](0,a3)},max:{x:g[aW](0,a6),y:g[aW](0,a3)}};}),H=aj(function(a9,a4){var R=r(a9),a5=a4&&r(a4),a6={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},d={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},a0=function(ba,bb){var i,bc;if(!ba){return["C",bb.x,bb.y,bb.x,bb.y,bb.x,bb.y];}!(ba[0] in {T:1,Q:1})&&(bb.qx=bb.qy=null);switch(ba[0]){case"M":bb.X=ba[1];bb.Y=ba[2];break;case"A":ba=["C"][aS](K[aW](0,[bb.x,bb.y][aS](ba.slice(1))));break;case"S":i=bb.x+(bb.x-(bb.bx||bb.x));bc=bb.y+(bb.y-(bb.by||bb.y));ba=["C",i,bc][aS](ba.slice(1));break;case"T":bb.qx=bb.x+(bb.x-(bb.qx||bb.x));bb.qy=bb.y+(bb.y-(bb.qy||bb.y));ba=["C"][aS](aK(bb.x,bb.y,bb.qx,bb.qy,ba[1],ba[2]));break;case"Q":bb.qx=ba[1];bb.qy=ba[2];ba=["C"][aS](aK(bb.x,bb.y,ba[1],ba[2],ba[3],ba[4]));break;case"L":ba=["C"][aS](aX(bb.x,bb.y,ba[1],ba[2]));break;case"H":ba=["C"][aS](aX(bb.x,bb.y,ba[1],bb.y));break;case"V":ba=["C"][aS](aX(bb.x,bb.y,bb.x,ba[1]));break;case"Z":ba=["C"][aS](aX(bb.x,bb.y,bb.X,bb.Y));break;}return ba;},e=function(ba,bb){if(ba[bb][m]>7){ba[bb].shift();var bc=ba[bb];while(bc[m]){ba.splice(bb++,0,["C"][aS](bc.splice(0,6)));}ba.splice(bb,1);a7=g(R[m],a5&&a5[m]||0);}},E=function(be,bd,bb,ba,bc){if(be&&bd&&be[bc][0]=="M"&&bd[bc][0]!="M"){bd.splice(bc,0,["M",ba.x,ba.y]);bb.bx=0;bb.by=0;bb.x=be[bc][1];bb.y=be[bc][2];a7=g(R[m],a5&&a5[m]||0);}};for(var a2=0,a7=g(R[m],a5&&a5[m]||0);a2<a7;a2++){R[a2]=a0(R[a2],a6);e(R,a2);a5&&(a5[a2]=a0(a5[a2],d));a5&&e(a5,a2);E(R,a5,a6,d,a2);E(a5,R,d,a6,a2);var a1=R[a2],a8=a5&&a5[a2],S=a1[m],a3=a5&&a8[m];a6.x=a1[S-2];a6.y=a1[S-1];a6.bx=W(a1[S-4])||a6.x;a6.by=W(a1[S-3])||a6.y;d.bx=a5&&(W(a8[a3-4])||d.x);d.by=a5&&(W(a8[a3-3])||d.y);d.x=a5&&a8[a3-2];d.y=a5&&a8[a3-1];}return a5?[R,a5]:R;},null,av),p=aj(function(a4){var a3=[];for(var a0=0,a5=a4[m];a0<a5;a0++){var e={},a2=a4[a0].match(/^([^:]*):?([\d\.]*)/);e.color=an.getRGB(a2[1]);if(e.color.error){return null;}e.color=e.color.hex;a2[2]&&(e.offset=a2[2]+"%");a3[f](e);}for(var a0=1,a5=a3[m]-1;a0<a5;a0++){if(!a3[a0].offset){var E=W(a3[a0-1].offset||0),R=0;for(var S=a0+1;S<a5;S++){if(a3[S].offset){R=a3[S].offset;break;}}if(!R){R=100;S=a5;}R=W(R);var a1=(R-E)/(S-a0+1);for(;a0<S;a0++){E+=a1;a3[a0].offset=E+"%";}}}return a3;}),ao=function(){var i,e,R,E,d;if(an.is(arguments[0],"string")||an.is(arguments[0],"object")){if(an.is(arguments[0],"string")){i=L.getElementById(arguments[0]);}else{i=arguments[0];}if(i.tagName){if(arguments[1]==null){return{container:i,width:i.style.pixelWidth||i.offsetWidth,height:i.style.pixelHeight||i.offsetHeight};}else{return{container:i,width:arguments[1],height:arguments[2]};}}}else{if(an.is(arguments[0],al)&&arguments[m]>3){return{container:1,x:arguments[0],y:arguments[1],width:arguments[2],height:arguments[3]};}}},aG=function(d,i){var e=this;for(var E in i){if(i[Q](E)&&!(E in d)){switch(typeof i[E]){case"function":(function(R){d[E]=d===e?R:function(){return R[aW](e,arguments);};})(i[E]);break;case"object":d[E]=d[E]||{};aG.call(this,d[E],i[E]);break;default:d[E]=i[E];break;}}}},ak=function(d,e){d==e.top&&(e.top=d.prev);d==e.bottom&&(e.bottom=d.next);d.next&&(d.next.prev=d.prev);d.prev&&(d.prev.next=d.next);},Y=function(d,e){if(e.top===d){return;}ak(d,e);d.next=null;d.prev=e.top;e.top.next=d;e.top=d;},k=function(d,e){if(e.bottom===d){return;}ak(d,e);d.next=e.bottom;d.prev=null;e.bottom.prev=d;e.bottom=d;},A=function(e,d,i){ak(e,i);d==i.top&&(i.top=e);d.next&&(d.next.prev=e);e.next=d.next;e.prev=d;d.next=e;},aq=function(e,d,i){ak(e,i);d==i.bottom&&(i.bottom=e);d.prev&&(d.prev.next=e);e.prev=d.prev;d.prev=e;e.next=d;},s=function(d){return function(){throw new Error("Rapha\xebl: you are calling to method \u201c"+d+"\u201d of removed object");};},ar=/^r(?:\(([^,]+?)\s*,\s*([^\)]+?)\))?/;if(an.svg){aT[aY].svgns="http://www.w3.org/2000/svg";aT[aY].xlink="http://www.w3.org/1999/xlink";var O=function(d){return +d+(~~d===d)*0.5;},V=function(S){for(var e=0,E=S[m];e<E;e++){if(aZ.call(S[e][0])!="a"){for(var d=1,R=S[e][m];d<R;d++){S[e][d]=O(S[e][d]);}}else{S[e][6]=O(S[e][6]);S[e][7]=O(S[e][7]);}}return S;},aJ=function(i,d){if(d){for(var e in d){if(d[Q](e)){i[v](e,d[e]);}}}else{return L.createElementNS(aT[aY].svgns,i);}};an[aA]=function(){return"Your browser supports SVG.\nYou are running Rapha\xebl "+this.version;};var q=function(d,E){var e=aJ("path");E.canvas&&E.canvas[aL](e);var i=new ax(e,E);i.type="path";aa(i,{fill:"none",stroke:"#000",path:d});return i;};var b=function(E,a7,d){var a4="linear",a1=0.5,S=0.5,a9=E.style;a7=(a7+at)[aP](ar,function(bb,i,bc){a4="radial";if(i&&bc){a1=W(i);S=W(bc);var ba=((S>0.5)*2-1);aM(a1-0.5,2)+aM(S-0.5,2)>0.25&&(S=ab.sqrt(0.25-aM(a1-0.5,2))*ba+0.5)&&S!=0.5&&(S=S.toFixed(5)-0.00001*ba);}return at;});a7=a7[z](/\s*\-\s*/);if(a4=="linear"){var a0=a7.shift();a0=-W(a0);if(isNaN(a0)){return null;}var R=[0,0,ab.cos(a0*ab.PI/180),ab.sin(a0*ab.PI/180)],a6=1/(g(ab.abs(R[2]),ab.abs(R[3]))||1);R[2]*=a6;R[3]*=a6;if(R[2]<0){R[0]=-R[2];R[2]=0;}if(R[3]<0){R[1]=-R[3];R[3]=0;}}var a3=p(a7);if(!a3){return null;}var e=aJ(a4+"Gradient");e.id="r"+(an._id++)[aA](36);aJ(e,a4=="radial"?{fx:a1,fy:S}:{x1:R[0],y1:R[1],x2:R[2],y2:R[3]});d.defs[aL](e);for(var a2=0,a8=a3[m];a2<a8;a2++){var a5=aJ("stop");aJ(a5,{offset:a3[a2].offset?a3[a2].offset:!a2?"0%":"100%","stop-color":a3[a2].color||"#fff"});e[aL](a5);}aJ(E,{fill:"url(#"+e.id+")",opacity:1,"fill-opacity":1});a9.fill=at;a9.opacity=1;a9.fillOpacity=1;return 1;};var N=function(e){var d=e.getBBox();aJ(e.pattern,{patternTransform:an.format("translate({0},{1})",d.x,d.y)});};var aa=function(a6,bf){var a9={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},bb=a6.node,a7=a6.attrs,a3=a6.rotate(),S=function(bm,bl){bl=a9[aZ.call(bl)];if(bl){var bj=bm.attrs["stroke-width"]||"1",bh={round:bj,square:bj,butt:0}[bm.attrs["stroke-linecap"]||bf["stroke-linecap"]]||0,bk=[];var bi=bl[m];while(bi--){bk[bi]=bl[bi]*bj+((bi%2)?1:-1)*bh;}aJ(bb,{"stroke-dasharray":bk[az](",")});}};bf[Q]("rotation")&&(a3=bf.rotation);var a2=(a3+at)[z](a);if(!(a2.length-1)){a2=null;}else{a2[1]=+a2[1];a2[2]=+a2[2];}W(a3)&&a6.rotate(0,true);for(var ba in bf){if(bf[Q](ba)){if(!j[Q](ba)){continue;}var a8=bf[ba];a7[ba]=a8;switch(ba){case"rotation":a6.rotate(a8,true);break;case"href":case"title":case"target":var bd=bb.parentNode;if(aZ.call(bd.tagName)!="a"){var E=aJ("a");bd.insertBefore(E,bb);E[aL](bb);bd=E;}bd.setAttributeNS(a6.paper.xlink,ba,a8);break;case"cursor":bb.style.cursor=a8;break;case"clip-rect":var e=(a8+at)[z](a);if(e[m]==4){a6.clip&&a6.clip.parentNode.parentNode.removeChild(a6.clip.parentNode);var i=aJ("clipPath"),bc=aJ("rect");i.id="r"+(an._id++)[aA](36);aJ(bc,{x:e[0],y:e[1],width:e[2],height:e[3]});i[aL](bc);a6.paper.defs[aL](i);aJ(bb,{"clip-path":"url(#"+i.id+")"});a6.clip=bc;}if(!a8){var be=L.getElementById(bb.getAttribute("clip-path")[aP](/(^url\(#|\)$)/g,at));be&&be.parentNode.removeChild(be);aJ(bb,{"clip-path":at});delete a6.clip;}break;case"path":if(a8&&a6.type=="path"){a7.path=V(r(a8));aJ(bb,{d:a7.path});}break;case"width":bb[v](ba,a8);if(a7.fx){ba="x";a8=a7.x;}else{break;}case"x":if(a7.fx){a8=-a7.x-(a7.width||0);}case"rx":if(ba=="rx"&&a6.type=="rect"){break;}case"cx":a2&&(ba=="x"||ba=="cx")&&(a2[1]+=a8-a7[ba]);bb[v](ba,O(a8));a6.pattern&&N(a6);break;case"height":bb[v](ba,a8);if(a7.fy){ba="y";a8=a7.y;}else{break;}case"y":if(a7.fy){a8=-a7.y-(a7.height||0);}case"ry":if(ba=="ry"&&a6.type=="rect"){break;}case"cy":a2&&(ba=="y"||ba=="cy")&&(a2[2]+=a8-a7[ba]);bb[v](ba,O(a8));a6.pattern&&N(a6);break;case"r":if(a6.type=="rect"){aJ(bb,{rx:a8,ry:a8});}else{bb[v](ba,a8);}break;case"src":if(a6.type=="image"){bb.setAttributeNS(a6.paper.xlink,"href",a8);}break;case"stroke-width":bb.style.strokeWidth=a8;bb[v](ba,a8);if(a7["stroke-dasharray"]){S(a6,a7["stroke-dasharray"]);}break;case"stroke-dasharray":S(a6,a8);break;case"translation":var a0=(a8+at)[z](a);a0[0]=+a0[0]||0;a0[1]=+a0[1]||0;if(a2){a2[1]+=a0[0];a2[2]+=a0[1];}t.call(a6,a0[0],a0[1]);break;case"scale":var a0=(a8+at)[z](a);a6.scale(+a0[0]||1,+a0[1]||+a0[0]||1,+a0[2]||null,+a0[3]||null);break;case"fill":var R=(a8+at).match(c);if(R){var i=aJ("pattern"),a5=aJ("image");i.id="r"+(an._id++)[aA](36);aJ(i,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1});aJ(a5,{x:0,y:0});a5.setAttributeNS(a6.paper.xlink,"href",R[1]);i[aL](a5);var bg=L.createElement("img");bg.style.cssText="position:absolute;left:-9999em;top-9999em";bg.onload=function(){aJ(i,{width:this.offsetWidth,height:this.offsetHeight});aJ(a5,{width:this.offsetWidth,height:this.offsetHeight});L.body.removeChild(this);a6.paper.safari();};L.body[aL](bg);bg.src=R[1];a6.paper.defs[aL](i);bb.style.fill="url(#"+i.id+")";aJ(bb,{fill:"url(#"+i.id+")"});a6.pattern=i;a6.pattern&&N(a6);break;}if(!an.getRGB(a8).error){delete bf.gradient;delete a7.gradient;!an.is(a7.opacity,"undefined")&&an.is(bf.opacity,"undefined")&&aJ(bb,{opacity:a7.opacity});!an.is(a7["fill-opacity"],"undefined")&&an.is(bf["fill-opacity"],"undefined")&&aJ(bb,{"fill-opacity":a7["fill-opacity"]});}else{if((({circle:1,ellipse:1})[Q](a6.type)||(a8+at).charAt()!="r")&&b(bb,a8,a6.paper)){a7.gradient=a8;a7.fill="none";break;}}case"stroke":bb[v](ba,an.getRGB(a8).hex);break;case"gradient":(({circle:1,ellipse:1})[Q](a6.type)||(a8+at).charAt()!="r")&&b(bb,a8,a6.paper);break;case"opacity":case"fill-opacity":if(a7.gradient){var d=L.getElementById(bb.getAttribute("fill")[aP](/^url\(#|\)$/g,at));if(d){var a1=d.getElementsByTagName("stop");a1[a1[m]-1][v]("stop-opacity",a8);}break;}default:ba=="font-size"&&(a8=G(a8,10)+"px");var a4=ba[aP](/(\-.)/g,function(bh){return aN.call(bh.substring(1));});bb.style[a4]=a8;bb[v](ba,a8);break;}}}D(a6,bf);if(a2){a6.rotate(a2.join(am));}else{W(a3)&&a6.rotate(a3,true);}};var h=1.2;var D=function(d,R){if(d.type!="text"||!(R[Q]("text")||R[Q]("font")||R[Q]("font-size")||R[Q]("x")||R[Q]("y"))){return;}var a3=d.attrs,e=d.node,a5=e.firstChild?G(L.defaultView.getComputedStyle(e.firstChild,at).getPropertyValue("font-size"),10):10;if(R[Q]("text")){a3.text=R.text;while(e.firstChild){e.removeChild(e.firstChild);}var E=(R.text+at)[z]("\n");for(var S=0,a4=E[m];S<a4;S++){if(E[S]){var a1=aJ("tspan");S&&aJ(a1,{dy:a5*h,x:a3.x});a1[aL](L.createTextNode(E[S]));e[aL](a1);}}}else{var E=e.getElementsByTagName("tspan");for(var S=0,a4=E[m];S<a4;S++){S&&aJ(E[S],{dy:a5*h,x:a3.x});}}aJ(e,{y:a3.y});var a0=d.getBBox(),a2=a3.y-(a0.y+a0.height/2);a2&&isFinite(a2)&&aJ(e,{y:a3.y+a2});};var ax=function(e,d){var E=0,i=0;this[0]=e;this.id=an._oid++;this.node=e;e.raphael=this;this.paper=d;this.attrs=this.attrs||{};this.transformations=[];this._={tx:0,ty:0,rt:{deg:0,cx:0,cy:0},sx:1,sy:1};!d.bottom&&(d.bottom=this);this.prev=d.top;d.top&&(d.top.next=this);d.top=this;this.next=null;};ax[aY].rotate=function(e,d,E){if(this.removed){return this;}if(e==null){if(this._.rt.cx){return[this._.rt.deg,this._.rt.cx,this._.rt.cy][az](am);}return this._.rt.deg;}var i=this.getBBox();e=(e+at)[z](a);if(e[m]-1){d=W(e[1]);E=W(e[2]);}e=W(e[0]);if(d!=null){this._.rt.deg=e;}else{this._.rt.deg+=e;}(E==null)&&(d=null);this._.rt.cx=d;this._.rt.cy=E;d=d==null?i.x+i.width/2:d;E=E==null?i.y+i.height/2:E;if(this._.rt.deg){this.transformations[0]=an.format("rotate({0} {1} {2})",this._.rt.deg,d,E);this.clip&&aJ(this.clip,{transform:an.format("rotate({0} {1} {2})",-this._.rt.deg,d,E)});}else{this.transformations[0]=at;this.clip&&aJ(this.clip,{transform:at});}aJ(this.node,{transform:this.transformations[az](am)});return this;};ax[aY].hide=function(){!this.removed&&(this.node.style.display="none");return this;};ax[aY].show=function(){!this.removed&&(this.node.style.display="");return this;};ax[aY].remove=function(){if(this.removed){return;}ak(this,this.paper);this.node.parentNode.removeChild(this.node);for(var d in this){delete this[d];}this.removed=true;};ax[aY].getBBox=function(){if(this.removed){return this;}if(this.type=="path"){return U(this.attrs.path);}if(this.node.style.display=="none"){this.show();var E=true;}var a1={};try{a1=this.node.getBBox();}catch(S){}finally{a1=a1||{};}if(this.type=="text"){a1={x:a1.x,y:Infinity,width:0,height:0};for(var d=0,R=this.node.getNumberOfChars();d<R;d++){var a0=this.node.getExtentOfChar(d);(a0.y<a1.y)&&(a1.y=a0.y);(a0.y+a0.height-a1.y>a1.height)&&(a1.height=a0.y+a0.height-a1.y);(a0.x+a0.width-a1.x>a1.width)&&(a1.width=a0.x+a0.width-a1.x);}}E&&this.hide();return a1;};ax[aY].attr=function(){if(this.removed){return this;}if(arguments[m]==0){var R={};for(var E in this.attrs){if(this.attrs[Q](E)){R[E]=this.attrs[E];}}this._.rt.deg&&(R.rotation=this.rotate());(this._.sx!=1||this._.sy!=1)&&(R.scale=this.scale());R.gradient&&R.fill=="none"&&(R.fill=R.gradient)&&delete R.gradient;return R;}if(arguments[m]==1&&an.is(arguments[0],"string")){if(arguments[0]=="translation"){return t.call(this);}if(arguments[0]=="rotation"){return this.rotate();}if(arguments[0]=="scale"){return this.scale();}if(arguments[0]=="fill"&&this.attrs.fill=="none"&&this.attrs.gradient){return this.attrs.gradient;}return this.attrs[arguments[0]];}if(arguments[m]==1&&an.is(arguments[0],"array")){var d={};for(var e in arguments[0]){if(arguments[0][Q](e)){d[arguments[0][e]]=this.attrs[arguments[0][e]];}}return d;}if(arguments[m]==2){var S={};S[arguments[0]]=arguments[1];aa(this,S);}else{if(arguments[m]==1&&an.is(arguments[0],"object")){aa(this,arguments[0]);}}return this;};ax[aY].toFront=function(){if(this.removed){return this;}this.node.parentNode[aL](this.node);var d=this.paper;d.top!=this&&Y(this,d);return this;};ax[aY].toBack=function(){if(this.removed){return this;}if(this.node.parentNode.firstChild!=this.node){this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild);k(this,this.paper);var d=this.paper;}return this;};ax[aY].insertAfter=function(d){if(this.removed){return this;}var e=d.node;if(e.nextSibling){e.parentNode.insertBefore(this.node,e.nextSibling);}else{e.parentNode[aL](this.node);}A(this,d,this.paper);return this;};ax[aY].insertBefore=function(d){if(this.removed){return this;}var e=d.node;e.parentNode.insertBefore(this.node,e);aq(this,d,this.paper);return this;};var P=function(e,d,S,R){d=O(d);S=O(S);var E=aJ("circle");e.canvas&&e.canvas[aL](E);var i=new ax(E,e);i.attrs={cx:d,cy:S,r:R,fill:"none",stroke:"#000"};i.type="circle";aJ(E,i.attrs);return i;};var aF=function(i,d,a1,e,S,a0){d=O(d);a1=O(a1);var R=aJ("rect");i.canvas&&i.canvas[aL](R);var E=new ax(R,i);E.attrs={x:d,y:a1,width:e,height:S,r:a0||0,rx:a0||0,ry:a0||0,fill:"none",stroke:"#000"};E.type="rect";aJ(R,E.attrs);return E;};var ai=function(e,d,a0,S,R){d=O(d);a0=O(a0);var E=aJ("ellipse");e.canvas&&e.canvas[aL](E);var i=new ax(E,e);i.attrs={cx:d,cy:a0,rx:S,ry:R,fill:"none",stroke:"#000"};i.type="ellipse";aJ(E,i.attrs);return i;};var o=function(i,a0,d,a1,e,S){var R=aJ("image");aJ(R,{x:d,y:a1,width:e,height:S,preserveAspectRatio:"none"});R.setAttributeNS(i.xlink,"href",a0);i.canvas&&i.canvas[aL](R);var E=new ax(R,i);E.attrs={x:d,y:a1,width:e,height:S,src:a0};E.type="image";return E;};var X=function(e,d,S,R){var E=aJ("text");aJ(E,{x:d,y:S,"text-anchor":"middle"});e.canvas&&e.canvas[aL](E);var i=new ax(E,e);i.attrs={x:d,y:S,"text-anchor":"middle",text:R,font:j.font,stroke:"none",fill:"#000"};i.type="text";aa(i,i.attrs);return i;};var aV=function(e,d){this.width=e||this.width;this.height=d||this.height;this.canvas[v]("width",this.width);this.canvas[v]("height",this.height);return this;};var w=function(){var E=ao[aW](null,arguments),i=E&&E.container,e=E.x,a0=E.y,R=E.width,d=E.height;if(!i){throw new Error("SVG container not found.");}var S=aJ("svg");R=R||512;d=d||342;aJ(S,{xmlns:"http://www.w3.org/2000/svg",version:1.1,width:R,height:d});if(i==1){S.style.cssText="position:absolute;left:"+e+"px;top:"+a0+"px";L.body[aL](S);}else{if(i.firstChild){i.insertBefore(S,i.firstChild);}else{i[aL](S);}}i=new aT;i.width=R;i.height=d;i.canvas=S;aG.call(i,i,an.fn);i.clear();return i;};aT[aY].clear=function(){var d=this.canvas;while(d.firstChild){d.removeChild(d.firstChild);}this.bottom=this.top=null;(this.desc=aJ("desc"))[aL](L.createTextNode("Created with Rapha\xebl"));d[aL](this.desc);d[aL](this.defs=aJ("defs"));};aT[aY].remove=function(){this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var d in this){this[d]=s(d);}};}if(an.vml){var aH=function(a8){var a5=/[ahqstv]/ig,a0=r;(a8+at).match(a5)&&(a0=H);a5=/[clmz]/g;if(a0==r&&!(a8+at).match(a5)){var e={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},R=/([clmz]),?([^clmz]*)/gi,S=/-?[^,\s-]+/g;var a4=(a8+at)[aP](R,function(a9,bb,i){var ba=[];i[aP](S,function(bc){ba[f](O(bc));});return e[bb]+ba;});return a4;}var a6=a0(a8),E,a4=[],d;for(var a2=0,a7=a6[m];a2<a7;a2++){E=a6[a2];d=aZ.call(a6[a2][0]);d=="z"&&(d="x");for(var a1=1,a3=E[m];a1<a3;a1++){d+=O(E[a1])+(a1!=a3-1?",":at);}a4[f](d);}return a4[az](am);};an[aA]=function(){return"Your browser doesn\u2019t support SVG. Falling down to VML.\nYou are running Rapha\xebl "+this.version;};var q=function(d,S){var E=ah("group");E.style.cssText="position:absolute;left:0;top:0;width:"+S.width+"px;height:"+S.height+"px";E.coordsize=S.coordsize;E.coordorigin=S.coordorigin;var i=ah("shape"),e=i.style;e.width=S.width+"px";e.height=S.height+"px";i.coordsize=this.coordsize;i.coordorigin=this.coordorigin;E[aL](i);var R=new ax(i,E,S);R.isAbsolute=true;R.type="path";R.path=[];R.Path=at;d&&aa(R,{fill:"none",stroke:"#000",path:d});S.canvas[aL](E);return R;};var aa=function(a3,a8){a3.attrs=a3.attrs||{};var a6=a3.node,a9=a3.attrs,a0=a6.style,E,bd=a3;for(var a1 in a8){if(a8[Q](a1)){a9[a1]=a8[a1];}}a8.href&&(a6.href=a8.href);a8.title&&(a6.title=a8.title);a8.target&&(a6.target=a8.target);a8.cursor&&(a0.cursor=a8.cursor);if(a8.path&&a3.type=="path"){a9.path=a8.path;a6.path=aH(a9.path);}if(a8.rotation!=null){a3.rotate(a8.rotation,true);}if(a8.translation){E=(a8.translation+at)[z](a);t.call(a3,E[0],E[1]);if(a3._.rt.cx!=null){a3._.rt.cx+=+E[0];a3._.rt.cy+=+E[1];a3.setBox(a3.attrs,E[0],E[1]);}}if(a8.scale){E=(a8.scale+at)[z](a);a3.scale(+E[0]||1,+E[1]||+E[0]||1,+E[2]||null,+E[3]||null);}if("clip-rect" in a8){var d=(a8["clip-rect"]+at)[z](a);if(d[m]==4){d[2]=+d[2]+(+d[0]);d[3]=+d[3]+(+d[1]);var a2=a6.clipRect||L.createElement("div"),bc=a2.style,S=a6.parentNode;bc.clip=an.format("rect({1}px {2}px {3}px {0}px)",d);if(!a6.clipRect){bc.position="absolute";bc.top=0;bc.left=0;bc.width=a3.paper.width+"px";bc.height=a3.paper.height+"px";S.parentNode.insertBefore(a2,S);a2[aL](S);a6.clipRect=a2;}}if(!a8["clip-rect"]){a6.clipRect&&(a6.clipRect.style.clip=at);}}if(a3.type=="image"&&a8.src){a6.src=a8.src;}if(a3.type=="image"&&a8.opacity){a6.filterOpacity=" progid:DXImageTransform.Microsoft.Alpha(opacity="+(a8.opacity*100)+")";a0.filter=(a6.filterMatrix||at)+(a6.filterOpacity||at);}a8.font&&(a0.font=a8.font);a8["font-family"]&&(a0.fontFamily='"'+a8["font-family"][z](",")[0][aP](/^['"]+|['"]+$/g,at)+'"');a8["font-size"]&&(a0.fontSize=a8["font-size"]);a8["font-weight"]&&(a0.fontWeight=a8["font-weight"]);a8["font-style"]&&(a0.fontStyle=a8["font-style"]);if(a8.opacity!=null||a8["stroke-width"]!=null||a8.fill!=null||a8.stroke!=null||a8["stroke-width"]!=null||a8["stroke-opacity"]!=null||a8["fill-opacity"]!=null||a8["stroke-dasharray"]!=null||a8["stroke-miterlimit"]!=null||a8["stroke-linejoin"]!=null||a8["stroke-linecap"]!=null){a6=a3.shape||a6;var a7=(a6.getElementsByTagName("fill")&&a6.getElementsByTagName("fill")[0]),ba=false;!a7&&(ba=a7=ah("fill"));if("fill-opacity" in a8||"opacity" in a8){var e=((+a9["fill-opacity"]+1||2)-1)*((+a9.opacity+1||2)-1);e<0&&(e=0);e>1&&(e=1);a7.opacity=e;}a8.fill&&(a7.on=true);if(a7.on==null||a8.fill=="none"){a7.on=false;}if(a7.on&&a8.fill){var i=a8.fill.match(c);if(i){a7.src=i[1];a7.type="tile";}else{a7.color=an.getRGB(a8.fill).hex;a7.src=at;a7.type="solid";if(an.getRGB(a8.fill).error&&(bd.type in {circle:1,ellipse:1}||(a8.fill+at).charAt()!="r")&&b(bd,a8.fill)){a9.fill="none";a9.gradient=a8.fill;}}}ba&&a6[aL](a7);var R=(a6.getElementsByTagName("stroke")&&a6.getElementsByTagName("stroke")[0]),bb=false;!R&&(bb=R=ah("stroke"));if((a8.stroke&&a8.stroke!="none")||a8["stroke-width"]||a8["stroke-opacity"]!=null||a8["stroke-dasharray"]||a8["stroke-miterlimit"]||a8["stroke-linejoin"]||a8["stroke-linecap"]){R.on=true;}(a8.stroke=="none"||R.on==null||a8.stroke==0||a8["stroke-width"]==0)&&(R.on=false);R.on&&a8.stroke&&(R.color=an.getRGB(a8.stroke).hex);var e=((+a9["stroke-opacity"]+1||2)-1)*((+a9.opacity+1||2)-1),a4=(W(a8["stroke-width"])||1)*0.75;e<0&&(e=0);e>1&&(e=1);a8["stroke-width"]==null&&(a4=a9["stroke-width"]);a8["stroke-width"]&&(R.weight=a4);a4&&a4<1&&(e*=a4)&&(R.weight=1);R.opacity=e;a8["stroke-linejoin"]&&(R.joinstyle=a8["stroke-linejoin"]||"miter");R.miterlimit=a8["stroke-miterlimit"]||8;a8["stroke-linecap"]&&(R.endcap=a8["stroke-linecap"]=="butt"?"flat":a8["stroke-linecap"]=="square"?"square":"round");if(a8["stroke-dasharray"]){var a5={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};R.dashstyle=a5[Q](a8["stroke-dasharray"])?a5[a8["stroke-dasharray"]]:at;}bb&&a6[aL](R);}if(bd.type=="text"){var a0=bd.paper.span.style;a9.font&&(a0.font=a9.font);a9["font-family"]&&(a0.fontFamily=a9["font-family"]);a9["font-size"]&&(a0.fontSize=a9["font-size"]);a9["font-weight"]&&(a0.fontWeight=a9["font-weight"]);a9["font-style"]&&(a0.fontStyle=a9["font-style"]);bd.node.string&&(bd.paper.span.innerHTML=(bd.node.string+at)[aP](/</g,"&#60;")[aP](/&/g,"&#38;")[aP](/\n/g,"<br>"));bd.W=a9.w=bd.paper.span.offsetWidth;bd.H=a9.h=bd.paper.span.offsetHeight;bd.X=a9.x;bd.Y=a9.y+O(bd.H/2);switch(a9["text-anchor"]){case"start":bd.node.style["v-text-align"]="left";bd.bbx=O(bd.W/2);break;case"end":bd.node.style["v-text-align"]="right";bd.bbx=-O(bd.W/2);break;default:bd.node.style["v-text-align"]="center";break;}}};var b=function(d,a1){d.attrs=d.attrs||{};var a2=d.attrs,a4=d.node.getElementsByTagName("fill"),S="linear",a0=".5 .5";d.attrs.gradient=a1;a1=(a1+at)[aP](ar,function(a6,a7,i){S="radial";if(a7&&i){a7=W(a7);i=W(i);aM(a7-0.5,2)+aM(i-0.5,2)>0.25&&(i=ab.sqrt(0.25-aM(a7-0.5,2))*((i>0.5)*2-1)+0.5);a0=a7+am+i;}return at;});a1=a1[z](/\s*\-\s*/);if(S=="linear"){var e=a1.shift();e=-W(e);if(isNaN(e)){return null;}}var R=p(a1);if(!R){return null;}d=d.shape||d.node;a4=a4[0]||ah("fill");if(R[m]){a4.on=true;a4.method="none";a4.type=(S=="radial")?"gradientradial":"gradient";a4.color=R[0].color;a4.color2=R[R[m]-1].color;var a5=[];for(var E=0,a3=R[m];E<a3;E++){R[E].offset&&a5[f](R[E].offset+am+R[E].color);}a4.colors&&(a4.colors.value=a5[m]?a5[az](","):"0% "+a4.color);if(S=="radial"){a4.focus="100%";a4.focussize=a0;a4.focusposition=a0;}else{a4.angle=(270-e)%360;}}return 1;};var ax=function(R,a0,d){var S=0,i=0,e=0,E=1;this[0]=R;this.id=an._oid++;this.node=R;R.raphael=this;this.X=0;this.Y=0;this.attrs={};this.Group=a0;this.paper=d;this._={tx:0,ty:0,rt:{deg:0},sx:1,sy:1};!d.bottom&&(d.bottom=this);this.prev=d.top;d.top&&(d.top.next=this);d.top=this;this.next=null;};ax[aY].rotate=function(e,d,i){if(this.removed){return this;}if(e==null){if(this._.rt.cx){return[this._.rt.deg,this._.rt.cx,this._.rt.cy][az](am);}return this._.rt.deg;}e=(e+at)[z](a);if(e[m]-1){d=W(e[1]);i=W(e[2]);}e=W(e[0]);if(d!=null){this._.rt.deg=e;}else{this._.rt.deg+=e;}i==null&&(d=null);this._.rt.cx=d;this._.rt.cy=i;this.setBox(this.attrs,d,i);this.Group.style.rotation=this._.rt.deg;return this;};ax[aY].setBox=function(bb,e,d){if(this.removed){return this;}var a5=this.Group.style,R=(this.shape&&this.shape.style)||this.node.style;bb=bb||{};for(var a9 in bb){if(bb[Q](a9)){this.attrs[a9]=bb[a9];}}e=e||this._.rt.cx;d=d||this._.rt.cy;var a7=this.attrs,a1,a0,a2,ba;switch(this.type){case"circle":a1=a7.cx-a7.r;a0=a7.cy-a7.r;a2=ba=a7.r*2;break;case"ellipse":a1=a7.cx-a7.rx;a0=a7.cy-a7.ry;a2=a7.rx*2;ba=a7.ry*2;break;case"rect":case"image":a1=+a7.x;a0=+a7.y;a2=a7.width||0;ba=a7.height||0;break;case"text":this.textpath.v=["m",O(a7.x),", ",O(a7.y-2),"l",O(a7.x)+1,", ",O(a7.y-2)][az](at);a1=a7.x-O(this.W/2);a0=a7.y-this.H/2;a2=this.W;ba=this.H;break;case"path":if(!this.attrs.path){a1=0;a0=0;a2=this.paper.width;ba=this.paper.height;}else{var a8=U(this.attrs.path);a1=a8.x;a0=a8.y;a2=a8.width;ba=a8.height;}break;default:a1=0;a0=0;a2=this.paper.width;ba=this.paper.height;break;}e=(e==null)?a1+a2/2:e;d=(d==null)?a0+ba/2:d;var E=e-this.paper.width/2,a4=d-this.paper.height/2;if(this.type=="path"||this.type=="text"){(a5.left!=E+"px")&&(a5.left=E+"px");(a5.top!=a4+"px")&&(a5.top=a4+"px");this.X=this.type=="text"?a1:-E;this.Y=this.type=="text"?a0:-a4;this.W=a2;this.H=ba;(R.left!=-E+"px")&&(R.left=-E+"px");(R.top!=-a4+"px")&&(R.top=-a4+"px");}else{(a5.left!=E+"px")&&(a5.left=E+"px");(a5.top!=a4+"px")&&(a5.top=a4+"px");this.X=a1;this.Y=a0;this.W=a2;this.H=ba;(a5.width!=this.paper.width+"px")&&(a5.width=this.paper.width+"px");(a5.height!=this.paper.height+"px")&&(a5.height=this.paper.height+"px");(R.left!=a1-E+"px")&&(R.left=a1-E+"px");(R.top!=a0-a4+"px")&&(R.top=a0-a4+"px");(R.width!=a2+"px")&&(R.width=a2+"px");(R.height!=ba+"px")&&(R.height=ba+"px");var S=(+bb.r||0)/aI(a2,ba);if(this.type=="rect"&&this.arcsize.toFixed(4)!=S.toFixed(4)&&(S||this.arcsize)){var a6=ah("roundrect"),bc={},a9=0,a3=this.events&&this.events[m];a6.arcsize=S;a6.raphael=this;this.Group[aL](a6);this.Group.removeChild(this.node);this[0]=this.node=a6;this.arcsize=S;for(var a9 in a7){bc[a9]=a7[a9];}delete bc.scale;this.attr(bc);if(this.events){for(;a9<a3;a9++){this.events[a9].unbind=ae(this.node,this.events[a9].name,this.events[a9].f,this);}}}}};ax[aY].hide=function(){!this.removed&&(this.Group.style.display="none");return this;};ax[aY].show=function(){!this.removed&&(this.Group.style.display="block");return this;};ax[aY].getBBox=function(){if(this.removed){return this;}if(this.type=="path"){return U(this.attrs.path);}return{x:this.X+(this.bbx||0),y:this.Y,width:this.W,height:this.H};};ax[aY].remove=function(){if(this.removed){return;}ak(this,this.paper);this.node.parentNode.removeChild(this.node);this.Group.parentNode.removeChild(this.Group);this.shape&&this.shape.parentNode.removeChild(this.shape);for(var d in this){delete this[d];}this.removed=true;};ax[aY].attr=function(){if(this.removed){return this;}if(arguments[m]==0){var E={};for(var e in this.attrs){if(this.attrs[Q](e)){E[e]=this.attrs[e];}}this._.rt.deg&&(E.rotation=this.rotate());(this._.sx!=1||this._.sy!=1)&&(E.scale=this.scale());E.gradient&&E.fill=="none"&&(E.fill=E.gradient)&&delete E.gradient;return E;}if(arguments[m]==1&&an.is(arguments[0],"string")){if(arguments[0]=="translation"){return t.call(this);}if(arguments[0]=="rotation"){return this.rotate();}if(arguments[0]=="scale"){return this.scale();}if(arguments[0]=="fill"&&this.attrs.fill=="none"&&this.attrs.gradient){return this.attrs.gradient;}return this.attrs[arguments[0]];}if(this.attrs&&arguments[m]==1&&an.is(arguments[0],"array")){var d={};for(var e=0,R=arguments[0][m];e<R;e++){d[arguments[0][e]]=this.attrs[arguments[0][e]];}return d;}var S;if(arguments[m]==2){S={};S[arguments[0]]=arguments[1];}arguments[m]==1&&an.is(arguments[0],"object")&&(S=arguments[0]);if(S){if(S.text&&this.type=="text"){this.node.string=S.text;}aa(this,S);if(S.gradient&&(({circle:1,ellipse:1})[Q](this.type)||(S.gradient+at).charAt()!="r")){b(this,S.gradient);}(this.type!="path"||this._.rt.deg)&&this.setBox(this.attrs);}return this;};ax[aY].toFront=function(){!this.removed&&this.Group.parentNode[aL](this.Group);this.paper.top!=this&&Y(this,this.paper);return this;};ax[aY].toBack=function(){if(this.removed){return this;}if(this.Group.parentNode.firstChild!=this.Group){this.Group.parentNode.insertBefore(this.Group,this.Group.parentNode.firstChild);k(this,this.paper);}return this;};ax[aY].insertAfter=function(d){if(this.removed){return this;}if(d.Group.nextSibling){d.Group.parentNode.insertBefore(this.Group,d.Group.nextSibling);}else{d.Group.parentNode[aL](this.Group);}A(this,d,this.paper);return this;};ax[aY].insertBefore=function(d){if(this.removed){return this;}d.Group.parentNode.insertBefore(this.Group,d.Group);aq(this,d,this.paper);return this;};var P=function(e,d,a1,S){var R=ah("group"),a0=ah("oval"),i=a0.style;R.style.cssText="position:absolute;left:0;top:0;width:"+e.width+"px;height:"+e.height+"px";R.coordsize=e.coordsize;R.coordorigin=e.coordorigin;R[aL](a0);var E=new ax(a0,R,e);E.type="circle";aa(E,{stroke:"#000",fill:"none"});E.attrs.cx=d;E.attrs.cy=a1;E.attrs.r=S;E.setBox({x:d-S,y:a1-S,width:S*2,height:S*2});e.canvas[aL](R);return E;},aF=function(e,a1,a0,a2,E,d){var R=ah("group"),i=ah("roundrect"),a3=(+d||0)/(aI(a2,E));R.style.cssText="position:absolute;left:0;top:0;width:"+e.width+"px;height:"+e.height+"px";R.coordsize=e.coordsize;R.coordorigin=e.coordorigin;R[aL](i);i.arcsize=a3;var S=new ax(i,R,e);S.type="rect";aa(S,{stroke:"#000"});S.arcsize=a3;S.setBox({x:a1,y:a0,width:a2,height:E,r:d});e.canvas[aL](R);return S;},ai=function(d,a2,a1,i,e){var R=ah("group"),E=ah("oval"),a0=E.style;R.style.cssText="position:absolute;left:0;top:0;width:"+d.width+"px;height:"+d.height+"px";R.coordsize=d.coordsize;R.coordorigin=d.coordorigin;R[aL](E);var S=new ax(E,R,d);S.type="ellipse";aa(S,{stroke:"#000"});S.attrs.cx=a2;S.attrs.cy=a1;S.attrs.rx=i;S.attrs.ry=e;S.setBox({x:a2-i,y:a1-e,width:i*2,height:e*2});d.canvas[aL](R);return S;},o=function(e,d,a2,a1,a3,E){var R=ah("group"),i=ah("image"),a0=i.style;R.style.cssText="position:absolute;left:0;top:0;width:"+e.width+"px;height:"+e.height+"px";R.coordsize=e.coordsize;R.coordorigin=e.coordorigin;i.src=d;R[aL](i);var S=new ax(i,R,e);S.type="image";S.attrs.src=d;S.attrs.x=a2;S.attrs.y=a1;S.attrs.w=a3;S.attrs.h=E;S.setBox({x:a2,y:a1,width:a3,height:E});e.canvas[aL](R);return S;},X=function(e,a2,a1,a3){var R=ah("group"),E=ah("shape"),a0=E.style,a4=ah("path"),d=a4.style,i=ah("textpath");R.style.cssText="position:absolute;left:0;top:0;width:"+e.width+"px;height:"+e.height+"px";R.coordsize=e.coordsize;R.coordorigin=e.coordorigin;a4.v=an.format("m{0},{1}l{2},{1}",O(a2),O(a1),O(a2)+1);a4.textpathok=true;a0.width=e.width;a0.height=e.height;i.string=a3+at;i.on=true;E[aL](i);E[aL](a4);R[aL](E);var S=new ax(i,R,e);S.shape=E;S.textpath=a4;S.type="text";S.attrs.text=a3;S.attrs.x=a2;S.attrs.y=a1;S.attrs.w=1;S.attrs.h=1;aa(S,{font:j.font,stroke:"none",fill:"#000"});S.setBox();e.canvas[aL](R);return S;},aV=function(i,d){var e=this.canvas.style;i==+i&&(i+="px");d==+d&&(d+="px");e.width=i;e.height=d;e.clip="rect(0 "+i+" "+d+" 0)";return this;},ah;L.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!L.namespaces.rvml&&L.namespaces.add("rvml","urn:schemas-microsoft-com:vml");ah=function(d){return L.createElement("<rvml:"+d+' class="rvml">');};}catch(af){ah=function(d){return L.createElement("<"+d+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">');};}var w=function(){var i=ao[aW](null,arguments),d=i.container,a2=i.height,a3,e=i.width,a1=i.x,a0=i.y;if(!d){throw new Error("VML container not found.");}var R=new aT,S=R.canvas=L.createElement("div"),E=S.style;e=e||512;a2=a2||342;e==+e&&(e+="px");a2==+a2&&(a2+="px");R.width=1000;R.height=1000;R.coordsize="1000 1000";R.coordorigin="0 0";R.span=L.createElement("span");R.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;";S[aL](R.span);E.cssText=an.format("width:{0};height:{1};position:absolute;clip:rect(0 {0} {1} 0);overflow:hidden",e,a2);if(d==1){L.body[aL](S);E.left=a1+"px";E.top=a0+"px";}else{d.style.width=e;d.style.height=a2;if(d.firstChild){d.insertBefore(S,d.firstChild);}else{d[aL](S);}}aG.call(R,R,an.fn);return R;};aT[aY].clear=function(){this.canvas.innerHTML=at;this.span=L.createElement("span");this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;";this.canvas[aL](this.span);this.bottom=this.top=null;};aT[aY].remove=function(){this.canvas.parentNode.removeChild(this.canvas);for(var d in this){this[d]=s(d);}};}if((/^Apple|^Google/).test(navigator.vendor)&&!(navigator.userAgent.indexOf("Version/4.0")+1)){aT[aY].safari=function(){var d=this.rect(-99,-99,this.width+99,this.height+99);setTimeout(function(){d.remove();});};}else{aT[aY].safari=function(){};}var ae=(function(){if(L.addEventListener){return function(R,i,e,d){var E=function(S){return e.call(d,S);};R.addEventListener(i,E,false);return function(){R.removeEventListener(i,E,false);return true;};};}else{if(L.attachEvent){return function(S,E,i,e){var R=function(a0){return i.call(e,a0||au.event);};S.attachEvent("on"+E,R);var d=function(){S.detachEvent("on"+E,R);return true;};return d;};}}})();for(var ac=F[m];ac--;){(function(d){ax[aY][d]=function(e){if(an.is(e,"function")){this.events=this.events||[];this.events.push({name:d,f:e,unbind:ae(this.shape||this.node,d,e,this)});}return this;};ax[aY]["un"+d]=function(E){var i=this.events,e=i[m];while(e--){if(i[e].name==d&&i[e].f==E){i[e].unbind();i.splice(e,1);!i.length&&delete this.events;return this;}}return this;};})(F[ac]);}ax[aY].hover=function(e,d){return this.mouseover(e).mouseout(d);};ax[aY].unhover=function(e,d){return this.unmouseover(e).unmouseout(d);};aT[aY].circle=function(d,i,e){return P(this,d||0,i||0,e||0);};aT[aY].rect=function(d,R,e,i,E){return aF(this,d||0,R||0,e||0,i||0,E||0);};aT[aY].ellipse=function(d,E,i,e){return ai(this,d||0,E||0,i||0,e||0);};aT[aY].path=function(d){d&&!an.is(d,"string")&&!an.is(d[0],"array")&&(d+=at);return q(an.format[aW](an,arguments),this);};aT[aY].image=function(E,d,R,e,i){return o(this,E||"about:blank",d||0,R||0,e||0,i||0);};aT[aY].text=function(d,i,e){return X(this,d||0,i||0,e||at);};aT[aY].set=function(d){arguments[m]>1&&(d=Array[aY].splice.call(arguments,0,arguments[m]));return new T(d);};aT[aY].setSize=aV;aT[aY].top=aT[aY].bottom=null;aT[aY].raphael=an;function u(){return this.x+am+this.y;}ax[aY].scale=function(a6,a5,E,e){if(a6==null&&a5==null){return{x:this._.sx,y:this._.sy,toString:u};}a5=a5||a6;!+a5&&(a5=a6);var ba,a8,a9,a7,bm=this.attrs;if(a6!=0){var a4=this.getBBox(),a1=a4.x+a4.width/2,R=a4.y+a4.height/2,bl=a6/this._.sx,bk=a5/this._.sy;E=(+E||E==0)?E:a1;e=(+e||e==0)?e:R;var a3=~~(a6/ab.abs(a6)),a0=~~(a5/ab.abs(a5)),be=this.node.style,bo=E+(a1-E)*bl,bn=e+(R-e)*bk;switch(this.type){case"rect":case"image":var a2=bm.width*a3*bl,bd=bm.height*a0*bk;this.attr({height:bd,r:bm.r*aI(a3*bl,a0*bk),width:a2,x:bo-a2/2,y:bn-bd/2});break;case"circle":case"ellipse":this.attr({rx:bm.rx*a3*bl,ry:bm.ry*a0*bk,r:bm.r*aI(a3*bl,a0*bk),cx:bo,cy:bn});break;case"path":var bg=ad(bm.path),bh=true;for(var bj=0,bc=bg[m];bj<bc;bj++){var bf=bg[bj],bi,S=aN.call(bf[0]);if(S=="M"&&bh){continue;}else{bh=false;}if(S=="A"){bf[bg[bj][m]-2]*=bl;bf[bg[bj][m]-1]*=bk;bf[1]*=a3*bl;bf[2]*=a0*bk;bf[5]=+(a3+a0?!!+bf[5]:!+bf[5]);}else{if(S=="H"){for(bi=1,jj=bf[m];bi<jj;bi++){bf[bi]*=bl;}}else{if(S=="V"){for(bi=1,jj=bf[m];bi<jj;bi++){bf[bi]*=bk;}}else{for(bi=1,jj=bf[m];bi<jj;bi++){bf[bi]*=(bi%2)?bl:bk;}}}}}var d=U(bg),ba=bo-d.x-d.width/2,a8=bn-d.y-d.height/2;bg[0][1]+=ba;bg[0][2]+=a8;this.attr({path:bg});break;}if(this.type in {text:1,image:1}&&(a3!=1||a0!=1)){if(this.transformations){this.transformations[2]="scale("[aS](a3,",",a0,")");this.node[v]("transform",this.transformations[az](am));ba=(a3==-1)?-bm.x-(a2||0):bm.x;a8=(a0==-1)?-bm.y-(bd||0):bm.y;this.attr({x:ba,y:a8});bm.fx=a3-1;bm.fy=a0-1;}else{this.node.filterMatrix=" progid:DXImageTransform.Microsoft.Matrix(M11="[aS](a3,", M12=0, M21=0, M22=",a0,", Dx=0, Dy=0, sizingmethod='auto expand', filtertype='bilinear')");be.filter=(this.node.filterMatrix||at)+(this.node.filterOpacity||at);}}else{if(this.transformations){this.transformations[2]=at;this.node[v]("transform",this.transformations[az](am));bm.fx=0;bm.fy=0;}else{this.node.filterMatrix=at;be.filter=(this.node.filterMatrix||at)+(this.node.filterOpacity||at);}}bm.scale=[a6,a5,E,e][az](am);this._.sx=a6;this._.sy=a5;}return this;};ax[aY].clone=function(){var d=this.attr();delete d.scale;delete d.translation;return this.paper[this.type]().attr(d);};var aB=function(d,e){return function(a9,S,a0){a9=H(a9);var a5,a4,E,a1,R="",a8={},a6,a3=0;for(var a2=0,a7=a9.length;a2<a7;a2++){E=a9[a2];if(E[0]=="M"){a5=+E[1];a4=+E[2];}else{a1=n(a5,a4,E[1],E[2],E[3],E[4],E[5],E[6]);if(a3+a1>S){if(e&&!a8.start){a6=an.findDotsAtSegment(a5,a4,E[1],E[2],E[3],E[4],E[5],E[6],(S-a3)/a1);R+=["C",a6.start.x,a6.start.y,a6.m.x,a6.m.y,a6.x,a6.y];if(a0){return R;}a8.start=R;R=["M",a6.x,a6.y+"C",a6.n.x,a6.n.y,a6.end.x,a6.end.y,E[5],E[6]][az]();a3+=a1;a5=+E[5];a4=+E[6];continue;}if(!d&&!e){a6=an.findDotsAtSegment(a5,a4,E[1],E[2],E[3],E[4],E[5],E[6],(S-a3)/a1);return{x:a6.x,y:a6.y,alpha:a6.alpha};}}a3+=a1;a5=+E[5];a4=+E[6];}R+=E;}a8.end=R;a6=d?a3:e?a8:an.findDotsAtSegment(a5,a4,E[1],E[2],E[3],E[4],E[5],E[6],1);a6.alpha&&(a6={x:a6.x,y:a6.y,alpha:a6.alpha});return a6;};},n=aj(function(E,d,a0,S,a6,a5,a4,a3){var R={x:0,y:0},a2=0;for(var a1=0;a1<1.01;a1+=0.01){var e=M(E,d,a0,S,a6,a5,a4,a3,a1);a1&&(a2+=ab.sqrt(aM(R.x-e.x,2)+aM(R.y-e.y,2)));R=e;}return a2;});var ap=aB(1),C=aB(),J=aB(0,1);ax[aY].getTotalLength=function(){if(this.type!="path"){return;}return ap(this.attrs.path);};ax[aY].getPointAtLength=function(d){if(this.type!="path"){return;}return C(this.attrs.path,d);};ax[aY].getSubpath=function(i,e){if(this.type!="path"){return;}if(ab.abs(this.getTotalLength()-e)<0.000001){return J(this.attrs.path,i).end;}var d=J(this.attrs.path,e,1);return i?J(d,i).end:d;};an.easing_formulas={linear:function(d){return d;},"<":function(d){return aM(d,3);},">":function(d){return aM(d-1,3)+1;},"<>":function(d){d=d*2;if(d<1){return aM(d,3)/2;}d-=2;return(aM(d,3)+2)/2;},backIn:function(e){var d=1.70158;return e*e*((d+1)*e-d);},backOut:function(e){e=e-1;var d=1.70158;return e*e*((d+1)*e+d)+1;},elastic:function(i){if(i==0||i==1){return i;}var e=0.3,d=e/4;return aM(2,-10*i)*ab.sin((i-d)*(2*ab.PI)/e)+1;},bounce:function(E){var e=7.5625,i=2.75,d;if(E<(1/i)){d=e*E*E;}else{if(E<(2/i)){E-=(1.5/i);d=e*E*E+0.75;}else{if(E<(2.5/i)){E-=(2.25/i);d=e*E*E+0.9375;}else{E-=(2.625/i);d=e*E*E+0.984375;}}}return d;}};var I={length:0},aR=function(){var a2=+new Date;for(var be in I){if(be!="length"&&I[Q](be)){var bj=I[be];if(bj.stop){delete I[be];I[m]--;continue;}var a0=a2-bj.start,bb=bj.ms,ba=bj.easing,bf=bj.from,a7=bj.diff,E=bj.to,a6=bj.t,a9=bj.prev||0,a1=bj.el,R=bj.callback,a8={},d;if(a0<bb){var S=an.easing_formulas[ba]?an.easing_formulas[ba](a0/bb):a0/bb;for(var bc in bf){if(bf[Q](bc)){switch(Z[bc]){case"along":d=S*bb*a7[bc];E.back&&(d=E.len-d);var bd=C(E[bc],d);a1.translate(a7.sx-a7.x||0,a7.sy-a7.y||0);a7.x=bd.x;a7.y=bd.y;a1.translate(bd.x-a7.sx,bd.y-a7.sy);E.rot&&a1.rotate(a7.r+bd.alpha,bd.x,bd.y);break;case"number":d=+bf[bc]+S*bb*a7[bc];break;case"colour":d="rgb("+[B(O(bf[bc].r+S*bb*a7[bc].r)),B(O(bf[bc].g+S*bb*a7[bc].g)),B(O(bf[bc].b+S*bb*a7[bc].b))][az](",")+")";break;case"path":d=[];for(var bh=0,a5=bf[bc][m];bh<a5;bh++){d[bh]=[bf[bc][bh][0]];for(var bg=1,bi=bf[bc][bh][m];bg<bi;bg++){d[bh][bg]=+bf[bc][bh][bg]+S*bb*a7[bc][bh][bg];}d[bh]=d[bh][az](am);}d=d[az](am);break;case"csv":switch(bc){case"translation":var a4=a7[bc][0]*(a0-a9),a3=a7[bc][1]*(a0-a9);a6.x+=a4;a6.y+=a3;d=a4+am+a3;break;case"rotation":d=+bf[bc][0]+S*bb*a7[bc][0];bf[bc][1]&&(d+=","+bf[bc][1]+","+bf[bc][2]);break;case"scale":d=[+bf[bc][0]+S*bb*a7[bc][0],+bf[bc][1]+S*bb*a7[bc][1],(2 in E[bc]?E[bc][2]:at),(3 in E[bc]?E[bc][3]:at)][az](am);break;case"clip-rect":d=[];var bh=4;while(bh--){d[bh]=+bf[bc][bh]+S*bb*a7[bc][bh];}break;}break;}a8[bc]=d;}}a1.attr(a8);a1._run&&a1._run.call(a1);}else{if(E.along){var bd=C(E.along,E.len*!E.back);a1.translate(a7.sx-(a7.x||0)+bd.x-a7.sx,a7.sy-(a7.y||0)+bd.y-a7.sy);E.rot&&a1.rotate(a7.r+bd.alpha,bd.x,bd.y);}(a6.x||a6.y)&&a1.translate(-a6.x,-a6.y);E.scale&&(E.scale=E.scale+at);a1.attr(E);delete I[be];I[m]--;a1.in_animation=null;an.is(R,"function")&&R.call(a1);}bj.prev=a0;}}an.svg&&a1&&a1.paper.safari();I[m]&&setTimeout(aR);},B=function(d){return d>255?255:(d<0?0:d);},t=function(d,i){if(d==null){return{x:this._.tx,y:this._.ty,toString:u};}this._.tx+=+d;this._.ty+=+i;switch(this.type){case"circle":case"ellipse":this.attr({cx:+d+this.attrs.cx,cy:+i+this.attrs.cy});break;case"rect":case"image":case"text":this.attr({x:+d+this.attrs.x,y:+i+this.attrs.y});break;case"path":var e=ad(this.attrs.path);e[0][1]+=+d;e[0][2]+=+i;this.attr({path:e});break;}return this;};ax[aY].animateWith=function(e,i,d,R,E){I[e.id]&&(i.start=I[e.id].start);return this.animate(i,d,R,E);};ax[aY].animateAlong=ay();ax[aY].animateAlongBack=ay(1);function ay(d){return function(E,i,e,S){var R={back:d};an.is(e,"function")?(S=e):(R.rot=e);E&&E.constructor==ax&&(E=E.attrs.path);E&&(R.along=E);return this.animate(R,i,S);};}ax[aY].onAnimation=function(d){this._run=d||0;return this;};ax[aY].animate=function(be,a5,a4,E){if(an.is(a4,"function")||!a4){E=a4||null;}var a9={},e={},a2={};for(var a6 in be){if(be[Q](a6)){if(Z[Q](a6)){a9[a6]=this.attr(a6);(a9[a6]==null)&&(a9[a6]=j[a6]);e[a6]=be[a6];switch(Z[a6]){case"along":var bc=ap(be[a6]),a7=C(be[a6],bc*!!be.back),R=this.getBBox();a2[a6]=bc/a5;a2.tx=R.x;a2.ty=R.y;a2.sx=a7.x;a2.sy=a7.y;e.rot=be.rot;e.back=be.back;e.len=bc;be.rot&&(a2.r=W(this.rotate())||0);break;case"number":a2[a6]=(e[a6]-a9[a6])/a5;break;case"colour":a9[a6]=an.getRGB(a9[a6]);var a8=an.getRGB(e[a6]);a2[a6]={r:(a8.r-a9[a6].r)/a5,g:(a8.g-a9[a6].g)/a5,b:(a8.b-a9[a6].b)/a5};break;case"path":var S=H(a9[a6],e[a6]);a9[a6]=S[0];var a3=S[1];a2[a6]=[];for(var bb=0,a1=a9[a6][m];bb<a1;bb++){a2[a6][bb]=[0];for(var ba=1,bd=a9[a6][bb][m];ba<bd;ba++){a2[a6][bb][ba]=(a3[bb][ba]-a9[a6][bb][ba])/a5;}}break;case"csv":var d=(be[a6]+at)[z](a),a0=(a9[a6]+at)[z](a);switch(a6){case"translation":a9[a6]=[0,0];a2[a6]=[d[0]/a5,d[1]/a5];break;case"rotation":a9[a6]=(a0[1]==d[1]&&a0[2]==d[2])?a0:[0,d[1],d[2]];a2[a6]=[(d[0]-a9[a6][0])/a5,0,0];break;case"scale":be[a6]=d;a9[a6]=(a9[a6]+at)[z](a);a2[a6]=[(d[0]-a9[a6][0])/a5,(d[1]-a9[a6][1])/a5,0,0];break;case"clip-rect":a9[a6]=(a9[a6]+at)[z](a);a2[a6]=[];var bb=4;while(bb--){a2[a6][bb]=(d[bb]-a9[a6][bb])/a5;}break;}e[a6]=d;}}}}this.stop();this.in_animation=1;I[this.id]={start:be.start||+new Date,ms:a5,easing:a4,from:a9,diff:a2,to:e,el:this,callback:E,t:{x:0,y:0}};++I[m]==1&&aR();return this;};ax[aY].stop=function(){I[this.id]&&I[m]--;delete I[this.id];return this;};ax[aY].translate=function(d,e){return this.attr({translation:d+" "+e});};ax[aY][aA]=function(){return"Rapha\xebl\u2019s object";};an.ae=I;var T=function(d){this.items=[];this[m]=0;if(d){for(var e=0,E=d[m];e<E;e++){if(d[e]&&(d[e].constructor==ax||d[e].constructor==T)){this[this.items[m]]=this.items[this.items[m]]=d[e];this[m]++;}}}};T[aY][f]=function(){var R,d;for(var e=0,E=arguments[m];e<E;e++){R=arguments[e];if(R&&(R.constructor==ax||R.constructor==T)){d=this.items[m];this[d]=this.items[d]=R;this[m]++;}}return this;};T[aY].pop=function(){delete this[this[m]--];return this.items.pop();};for(var y in ax[aY]){if(ax[aY][Q](y)){T[aY][y]=(function(d){return function(){for(var e=0,E=this.items[m];e<E;e++){this.items[e][d][aW](this.items[e],arguments);}return this;};})(y);}}T[aY].attr=function(e,a0){if(e&&an.is(e,"array")&&an.is(e[0],"object")){for(var d=0,S=e[m];d<S;d++){this.items[d].attr(e[d]);}}else{for(var E=0,R=this.items[m];E<R;E++){this.items[E].attr[aW](this.items[E],arguments);}}return this;};T[aY].animate=function(S,e,a2,a1){(an.is(a2,"function")||!a2)&&(a1=a2||null);var d=this.items[m],E=d,a0=this,R;a1&&(R=function(){!--d&&a1.call(a0);});this.items[--E].animate(S,e,a2||R,R);while(E--){this.items[E].animateWith(this.items[d-1],S,e,a2||R,R);}return this;};T[aY].insertAfter=function(e){var d=this.items[m];while(d--){this.items[d].insertAfter(e);}return this;};T[aY].getBBox=function(){var d=[],a0=[],e=[],R=[];for(var E=this.items[m];E--;){var S=this.items[E].getBBox();d[f](S.x);a0[f](S.y);e[f](S.x+S.width);R[f](S.y+S.height);}d=aI[aW](0,d);a0=aI[aW](0,a0);return{x:d,y:a0,width:g[aW](0,e)-d,height:g[aW](0,R)-a0};};an.registerFont=function(e){if(!e.face){return e;}this.fonts=this.fonts||{};var E={w:e.w,face:{},glyphs:{}},i=e.face["font-family"];for(var a0 in e.face){if(e.face[Q](a0)){E.face[a0]=e.face[a0];}}if(this.fonts[i]){this.fonts[i][f](E);}else{this.fonts[i]=[E];}if(!e.svg){E.face["units-per-em"]=G(e.face["units-per-em"],10);for(var R in e.glyphs){if(e.glyphs[Q](R)){var S=e.glyphs[R];E.glyphs[R]={w:S.w,k:{},d:S.d&&"M"+S.d[aP](/[mlcxtrv]/g,function(a1){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[a1]||"M";})+"z"};if(S.k){for(var d in S.k){if(S[Q](d)){E.glyphs[R].k[d]=S.k[d];}}}}}}return e;};aT[aY].getFont=function(a2,a3,e,R){R=R||"normal";e=e||"normal";a3=+a3||{normal:400,bold:700,lighter:300,bolder:800}[a3]||400;var S=an.fonts[a2];if(!S){var E=new RegExp("(^|\\s)"+a2[aP](/[^\w\d\s+!~.:_-]/g,at)+"(\\s|$)","i");for(var d in an.fonts){if(an.fonts[Q](d)){if(E.test(d)){S=an.fonts[d];break;}}}}var a0;if(S){for(var a1=0,a4=S[m];a1<a4;a1++){a0=S[a1];if(a0.face["font-weight"]==a3&&(a0.face["font-style"]==e||!a0.face["font-style"])&&a0.face["font-stretch"]==R){break;}}}return a0;};aT[aY].print=function(R,E,d,a1,a2,bb){bb=bb||"middle";var a7=this.set(),ba=(d+at)[z](at),a8=0,a4=at,bc;an.is(a1,"string")&&(a1=this.getFont(a1));if(a1){bc=(a2||16)/a1.face["units-per-em"];var e=a1.face.bbox.split(a),a0=+e[0],a3=+e[1]+(bb=="baseline"?e[3]-e[1]+(+a1.face.descent):(e[3]-e[1])/2);for(var a6=0,S=ba[m];a6<S;a6++){var a5=a6&&a1.glyphs[ba[a6-1]]||{},a9=a1.glyphs[ba[a6]];a8+=a6?(a5.w||a1.w)+(a5.k&&a5.k[ba[a6]]||0):0;a9&&a9.d&&a7[f](this.path(a9.d).attr({fill:"#000",stroke:"none",translation:[a8,0]}));}a7.scale(bc,bc,a0,a3).translate(R-a0,E-a3);}return a7;};an.format=function(i){var e=an.is(arguments[1],"array")?[0][aS](arguments[1]):arguments,d=/\{(\d+)\}/g;i&&an.is(i,"string")&&e[m]-1&&(i=i[aP](d,function(R,E){return e[++E]==null?at:e[E];}));return i||at;};an.ninja=function(){var d=Raphael;if(l.was){Raphael=l.is;}else{delete Raphael;}return d;};an.el=ax[aY];return an;})();
if(!this.JSON){this.JSON={};}
(function(){function f(n){return n<10?'0'+n:n;}
if(typeof Date.prototype.toJSON!=='function'){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+'-'+
f(this.getUTCMonth()+1)+'-'+
f(this.getUTCDate())+'T'+
f(this.getUTCHours())+':'+
f(this.getUTCMinutes())+':'+
f(this.getUTCSeconds())+'Z':null;};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf();};}
var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==='string'?c:'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+string+'"';}
function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==='object'&&typeof value.toJSON==='function'){value=value.toJSON(key);}
if(typeof rep==='function'){value=rep.call(holder,key,value);}
switch(typeof value){case'string':return quote(value);case'number':return isFinite(value)?String(value):'null';case'boolean':case'null':return String(value);case'object':if(!value){return'null';}
gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==='[object Array]'){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||'null';}
v=partial.length===0?'[]':gap?'[\n'+gap+
partial.join(',\n'+gap)+'\n'+
mind+']':'['+partial.join(',')+']';gap=mind;return v;}
if(rep&&typeof rep==='object'){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==='string'){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}
v=partial.length===0?'{}':gap?'{\n'+gap+partial.join(',\n'+gap)+'\n'+
mind+'}':'{'+partial.join(',')+'}';gap=mind;return v;}}
if(typeof JSON.stringify!=='function'){JSON.stringify=function(value,replacer,space){var i;gap='';indent='';if(typeof space==='number'){for(i=0;i<space;i+=1){indent+=' ';}}else if(typeof space==='string'){indent=space;}
rep=replacer;if(replacer&&typeof replacer!=='function'&&(typeof replacer!=='object'||typeof replacer.length!=='number')){throw new Error('JSON.stringify');}
return str('',{'':value});};}
if(typeof JSON.parse!=='function'){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==='object'){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v;}else{delete value[k];}}}}
return reviver.call(holder,key,value);}
text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return'\\u'+
('0000'+a.charCodeAt(0).toString(16)).slice(-4);});}
if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,''))){j=eval('('+text+')');return typeof reviver==='function'?walk({'':j},''):j;}
throw new SyntaxError('JSON.parse');};}}());/**
 * Joint 0.2 - JavaScript diagramming library.
 * Copyright (c) David Durman 2009 - 2010
 * Licensed under the MIT license: (http://www.opensource.org/licenses/mit-license.php)
 */

(function(global){var
math=global.Math,cos=math.cos,sin=math.sin,sqrt=math.sqrt,mmin=math.min,mmax=math.max,atan2=math.atan2,acos=math.acos,PI=math.PI;var enqueue=function(fnc){setTimeout(fnc,0);};if(!global.console){global.console={log:function(){},warn:function(){},error:function(){},debug:function(){}};}
if(!Array.indexOf){Array.prototype.indexOf=function(obj,start){for(var i=(start||0),len=this.length;i<len;i++){if(this[i]==obj){return i;}}
return-1;};}
function Joint(from,to,opt){if(!(this instanceof Joint)){return new Joint(from,to,opt);}
var paper=this.paper=Joint.paper();this._registeredObjects=[];this._conVerticesCurrentIndex=0;this._nearbyVertexSqrDist=500;this._lastStartCapSticker=null;this._lastEndCapSticker=null;this.dom={};this._start={shape:null,dummy:false};this._end={shape:null,dummy:false};this._opt={vertices:[],attrs:{"stroke":"#000","fill-opacity":0.0,"stroke-width":1,"stroke-dasharray":"-","stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":1,"stroke-opacity":1.0},cursor:"move",beSmooth:false,interactive:true,label:undefined,labelAttrs:{"font-size":12,"fill":"#000"},labelBoxAttrs:{stroke:"white",fill:"white"},bboxCorrection:{start:{type:null,x:0,y:0,width:0,height:0},end:{type:null,x:0,y:0,width:0,height:0}},dummy:{start:{radius:1,attrs:{"opacity":0.0,"fill":"red"}},end:{radius:1,attrs:{"opacity":0.0,"fill":"yellow"}}},handle:{timeout:2000,start:{enabled:false,radius:4,attrs:{opacity:1.0,fill:"red",stroke:"black"}},end:{enabled:false,radius:4,attrs:{opacity:1.0,fill:"red",stroke:"black"}}}};this._opt.arrow={start:Joint.getArrow("none",2,this._opt.attrs),end:Joint.getArrow("basic",5)};if(opt)this.processOptions(opt);JointDOMBuilder.init(this.paper,this._opt,this._start,this._end);var startObject=this._start,endObject=this._end;if(from.x&&from.y)
JointDOMBuilder.dummy(startObject,from,this._opt.dummy.start);else
startObject.shape=from.yourself();if(to.x&&to.y)
JointDOMBuilder.dummy(endObject,to,this._opt.dummy.end);else
endObject.shape=to.yourself();this.addJoint(startObject.shape);this.addJoint(endObject.shape);this.update();}
global.Joint=Joint;Joint.euid=1;Joint.generateEuid=function(){if(this._euid===undefined)this._euid=Joint.euid++;return this._euid;};Joint.prototype={_dx:undefined,_dy:undefined,IDLE:0,STARTCAPDRAGGING:1,ENDCAPDRAGGING:2,CONNECTIONWIRING:3,state:0,_callbacks:{justConnected:function(side){},disconnected:function(side){},justBroken:function(mousePos){},wiring:function(mousePos){},objectMoving:function(obj){}},euid:function(){return Joint.generateEuid.call(this);},connection:function(){return this.dom.connection;},endObject:function(){return this._end.shape;},startObject:function(){return this._start.shape;},endCap:function(){return this.dom.endCap;},endCapConnected:function(){return!this._end.dummy;},startCap:function(){return this.dom.startCap;},startCapConnected:function(){return!this._start.dummy;},isStartDummy:function(){return this._start.dummy;},isEndDummy:function(){return this._end.dummy;},replaceDummy:function(startOrEnd,o){startOrEnd.shape.remove();startOrEnd.dummy=false;startOrEnd.shape=o;},callback:function(fnc,scope,args){this._callbacks[fnc].apply(scope,args);},objectContainingPoint:function(p){var register=this._registeredObjects,idx=(register?register.length:0),o;while(idx--){o=register[idx].yourself();if(rect(o.getBBox()).containsPoint(p))
return o;}
return null;},freeJoint:function(obj){var jar=obj.yourself().joints(),i=jar.indexOf(this);jar.splice(i,1);return this;},addJoint:function(obj){var joints=obj.joints();;if(joints.indexOf(this)===-1)joints.push(this);},capMouseDown:function(e,cap){Joint.currentJoint=this;this._dx=e.clientX;this._dy=e.clientY;if(cap===this.dom.startCap){if(!this.isStartDummy()){this._lastStartCapSticker=this.startObject();this.draw(["dummyStart"]);}
this.state=this.STARTCAPDRAGGING;}else if(cap===this.dom.endCap){if(!this.isEndDummy()){this._lastEndCapSticker=this.endObject();this.draw(["dummyEnd"]);}
this.state=this.ENDCAPDRAGGING;}},connectionMouseDown:function(e){Joint.currentJoint=this;var mousePos=Joint.getMousePosition(e,this.paper.canvas);for(var i=0,len=this._opt.vertices.length;i<len;i++){var v=this._opt.vertices[i];if(line(v,mousePos).squaredLength()<this._nearbyVertexSqrDist){this._conVerticesCurrentIndex=i;this.state=this.CONNECTIONWIRING;return;}}
var sbbCenter=rect(this.startObject().getBBox()).center(),ebbCenter=rect(this.endObject().getBBox()).center(),smLineSqrLen=line(sbbCenter,mousePos).squaredLength(),emLineSqrLen=line(ebbCenter,mousePos).squaredLength();if(smLineSqrLen<emLineSqrLen){this._conVerticesCurrentIndex=0;this._opt.vertices.unshift(mousePos);}else{this._conVerticesCurrentIndex=this._opt.vertices.push(mousePos)-1;}
this.state=this.CONNECTIONWIRING;this.callback("justBroken",this,[mousePos]);},capDragging:function(e){if(this.state===this.STARTCAPDRAGGING){this.startObject().translate(e.clientX-this._dx,e.clientY-this._dy);}else if(this.state===this.ENDCAPDRAGGING){this.endObject().translate(e.clientX-this._dx,e.clientY-this._dy);}else{return;}
this._dx=e.clientX;this._dy=e.clientY;this.update();},capEndDragging:function(){var dummyBB,disconnectedFrom,STARTCAPDRAGGING=(this.state===this.STARTCAPDRAGGING),ENDCAPDRAGGING=(this.state===this.ENDCAPDRAGGING),capType=(STARTCAPDRAGGING)?"start":"end";if(STARTCAPDRAGGING){dummyBB=this.startObject().getBBox();disconnectedFrom=this._lastStartCapSticker;}else if(ENDCAPDRAGGING){dummyBB=this.endObject().getBBox();disconnectedFrom=this._lastEndCapSticker;}
this._lastStartCapSticker=this._lastEndCapSticker=null;if(disconnectedFrom){this.freeJoint(disconnectedFrom);this.callback("disconnected",disconnectedFrom,[capType]);}
var o=this.objectContainingPoint(point(dummyBB.x,dummyBB.y));if(o){this.callback("justConnected",o,[capType]);this.replaceDummy(this["_"+capType],o);this.addJoint(o);}
this.update();},connectionWiring:function(e){var mousePos=Joint.getMousePosition(e,this.paper.canvas);this._opt.vertices[this._conVerticesCurrentIndex]=mousePos;this.update();this.callback("wiring",this,[mousePos]);},update:function(){this.redraw().listenAll();},redraw:function(){this.clean(["connection","startCap","endCap","handleStart","handleEnd","label"]);this.draw(["connection","startCap","endCap","handleStart","handleEnd","label"]);return this;},listenAll:function(){if(!this._opt.interactive){return this;}
var self=this;this.dom.startCap.mousedown(function(e){Joint.fixEvent(e);self.capMouseDown(e,self.dom.startCap);e.stopPropagation();e.preventDefault();});this.dom.endCap.mousedown(function(e){Joint.fixEvent(e);self.capMouseDown(e,self.dom.endCap);e.stopPropagation();e.preventDefault();});this.dom.connection.mousedown(function(e){Joint.fixEvent(e);self.connectionMouseDown(e);e.stopPropagation();e.preventDefault();});if(this._opt.handle.start.enabled){this.dom.handleStart.mousedown(function(e){Joint.fixEvent(e);self.capMouseDown(e,self.dom.startCap);e.stopPropagation();e.preventDefault();});}
if(this._opt.handle.end.enabled){this.dom.handleEnd.mousedown(function(e){Joint.fixEvent(e);self.capMouseDown(e,self.dom.endCap);e.stopPropagation();e.preventDefault();});}
if(this._opt.handle.timeout!==Infinity){this.dom.connection.mouseover(function(e){Joint.fixEvent(e);self.showHandle();setTimeout(function(){self.hideHandle();},self._opt.handle.timeout);e.stopPropagation();e.preventDefault();});}
return this;},boundPoint:function(bbox,type,p){if(type==="circle"||type==="ellipse")
return ellipse(bbox.center(),bbox.width/2,bbox.height/2).intersectionWithLineFromCenterToPoint(p);return bbox.boundPoint(p)||bbox.center();},jointLocation:function(start,end,vertices){var verticesLength=vertices.length,theta,firstVertex=(vertices.length?vertices[0]:undefined),lastVertex=(vertices.length?vertices[verticesLength-1]:undefined),p1,p1bp,c1t,c1r,p2,p2bp,c2t,c2r;p1bp=this.boundPoint(start.bbox,start.type,firstVertex||end.bbox.center());theta=start.bbox.center().theta(firstVertex||end.bbox.center());p1=point(p1bp.x+(2*start.shift.dx*cos(theta.radians)),p1bp.y+(-2*start.shift.dy*sin(theta.radians)));c1t=point(p1bp.x+start.shift.dx*cos(theta.radians),p1bp.y-start.shift.dy*sin(theta.radians));c1r=360-theta.degrees+180;p2bp=this.boundPoint(end.bbox,end.type,lastVertex||start.bbox.center());theta=(lastVertex||start.bbox.center()).theta(end.bbox.center());p2=point(p2bp.x+(-2*end.shift.dx*cos(theta.radians)),p2bp.y+(2*end.shift.dy*sin(theta.radians)));c2t=point(p2bp.x-end.shift.dx*cos(theta.radians),p2bp.y+end.shift.dy*sin(theta.radians));c2r=360-theta.degrees;return{start:{bound:p1bp,connection:p1,translate:c1t,rotate:c1r},end:{bound:p2bp,connection:p2,translate:c2t,rotate:c2r}};},connectionPathCommands:function(start,end,vertices,smooth){if(smooth)
return Bezier.curveThroughPoints([start].concat(vertices,[end]));var commands=["M",start.x,start.y],i=0,l=vertices.length;for(;i<l;i++)
commands.push("L",vertices[i].x,vertices[i].y);commands.push("L",end.x,end.y);return commands;},labelLocation:function(start,end,vertices){var p=start,i=0,l=vertices.length;for(;i<l;i++)
p=line(p,vertices[i]).midpoint();return line(p,end).midpoint();},draw:function(components){var self=this,paper=this.paper,jointLocation=this.jointLocation({bbox:rect(this.startObject().getBBox()).moveAndExpand(this._opt.bboxCorrection.start),type:this.startObject().type,shift:this._opt.arrow.start},{bbox:rect(this.endObject().getBBox()).moveAndExpand(this._opt.bboxCorrection.end),type:this.endObject().type,shift:this._opt.arrow.end},this._opt.vertices),connectionPathCommands=this.connectionPathCommands(jointLocation.start.connection,jointLocation.end.connection,this._opt.vertices,this._opt.beSmooth),labelLocation=this.labelLocation(jointLocation.start.connection,jointLocation.end.connection,this._opt.vertices),dom=JointDOMBuilder.init(this.paper,this._opt,this._start,this._end,jointLocation,connectionPathCommands,labelLocation),l=components.length,component;for(var i=0;i<l;i++){component=components[i];this.dom[component]=dom[component]();}},clean:function(components){var component,name,subComponents,idx=components.length;while(idx--){name=components[idx];component=this.dom[name];if(component){if(component.node){component.remove();this.dom[name]=null;}else{subComponents=component;for(var key in subComponents){if(subComponents.hasOwnProperty(key))
subComponents[key].remove();}}
this.dom[name]=null;}}},processOptions:function(opt){var key;if(opt.interactive!==undefined)this._opt.interactive=opt.interactive;if(opt.attrs){for(key in opt.attrs){this._opt.attrs[key]=opt.attrs[key];}}
if(opt.cursor)this._opt.cursor=opt.cursor;if(opt.beSmooth)this._opt.beSmooth=opt.beSmooth;if(opt.label)this._opt.label=opt.label;if(opt.labelAttrs){for(key in opt.labelAttrs){this._opt.labelAttrs[key]=opt.labelAttrs[key];}}
if(opt.vertices){for(var i=0,l=opt.vertices.length;i<l;i++){this._opt.vertices.push(point(opt.vertices[i].x,opt.vertices[i].y));}}
if(opt.bboxCorrection){if(opt.bboxCorrection.start){for(key in opt.bboxCorrection.start){this._opt.bboxCorrection.start[key]=opt.bboxCorrection.start[key];}}
if(opt.bboxCorrection.end){for(key in opt.bboxCorrection.end){this._opt.bboxCorrection.end[key]=opt.bboxCorrection.end[key];}}}
var sa=opt.startArrow,ea=opt.endArrow;if(sa&&sa.type)this._opt.arrow.start=Joint.getArrow(sa.type,sa.size,sa.attrs);if(ea&&ea.type)this._opt.arrow.end=Joint.getArrow(ea.type,ea.size,ea.attrs);if(opt.arrow){if(opt.arrow.start)this._opt.arrow.start=opt.arrow.start;if(opt.arrow.end)this._opt.arrow.end=opt.arrow.end;}
if(opt.dummy){if(opt.dummy.start){if(opt.dummy.start.radius)this._opt.dummy.start.radius=opt.dummy.start.radius;if(opt.dummy.start.attrs){for(key in opt.dummy.start.attrs){this._opt.dummy.start.attrs[key]=opt.dummy.start.attrs[key];}}}
if(opt.dummy.end){if(opt.dummy.end.radius)this._opt.dummy.end.radius=opt.dummy.end.radius;if(opt.dummy.end.attrs){for(key in opt.dummy.end.attrs){this._opt.dummy.end.attrs[key]=opt.dummy.end.attrs[key];}}}}
if(opt.handle){if(opt.handle.timeout)this._opt.handle.timeout=opt.handle.timeout;if(opt.handle.start){if(opt.handle.start.enabled)this._opt.handle.start.enabled=opt.handle.start.enabled;if(opt.handle.start.radius)this._opt.handle.start.radius=opt.handle.start.radius;if(opt.handle.start.attrs){for(key in opt.handle.start.attrs){this._opt.handle.start.attrs[key]=opt.handle.start.attrs[key];}}}
if(opt.handle.end){if(opt.handle.end.enabled)this._opt.handle.end.enabled=opt.handle.end.enabled;if(opt.handle.end.radius)this._opt.handle.end.radius=opt.handle.end.radius;if(opt.handle.end.attrs){for(key in opt.handle.end.attrs){this._opt.handle.end.attrs[key]=opt.handle.end.attrs[key];}}}}},register:function(obj,cap){if(!cap){cap="both";}
var toRegister=(obj.constructor==Array)?obj:[obj];for(var i=0,len=toRegister.length;i<len;i++){toRegister[i].yourself()._capToStick=cap;this._registeredObjects.push(toRegister[i]);}
return this;},registerForever:function(arr){if(Object.prototype.toString.call(arr)!=="[object Array]")
arr=Array.prototype.slice.call(arguments);this._registeredObjects=arr;return this;},unregister:function(obj,cap){cap=cap||"both";var index=-1;for(var i=0,len=this._registeredObjects.length;i<len;i++){var capToStick=this._registeredObjects[i].yourself()._capToStick||"both";if(this._registeredObjects[i]===obj&&capToStick===cap){index=i;break;}}
if(index!==-1){this._registeredObjects.splice(index,1);}
return this;},registeredObjects:function(){return this._registeredObjects;},setVertices:function(vertices){var conVertices=this._opt.vertices=[],p;for(var i=0,l=vertices.length;i<l;i++){p=(vertices[i].y===undefined)?point(vertices[i]):point(vertices[i].x,vertices[i].y);conVertices.push(p);}
this.update();return this;},getVertices:function(){return this._opt.vertices;},toggleSmoothing:function(){this._opt.beSmooth=!this._opt.beSmooth;this.update();return this;},isSmooth:function(){return this._opt.beSmooth;},label:function(str){this._opt.label=str;this.update();return this;},registerCallback:function(evt,fnc){this._callbacks[evt]=fnc;return this;},straighten:function(){this._opt.vertices=[];this.update();return this;},toggleHandle:function(cap){var handle=this._opt.handle;if(!cap){handle.start.enabled=!handle.start.enabled;handle.end.enabled=!handle.end.enabled;}else{handle[cap].enabled=!handle[cap].enabled;}
this.update();return this;},showHandle:function(cap){var handle=this._opt.handle;if(!cap){handle.start.enabled=true;handle.end.enabled=true;}else{handle[cap].enabled=true;}
this.update();return this;},hideHandle:function(cap){var handle=this._opt.handle;if(!cap){handle.start.enabled=false;handle.end.enabled=false;}else{handle[cap].enabled=false;}
this.update();return this;},setBBoxCorrection:function(corr,cap){if(!cap){this._opt.bboxCorrection.start=this._opt.bboxCorrection.end=corr;}else{this._opt.bboxCorrection[cap]=corr;}
this.update();return this;},highlight:function(color){color=color||"red";this.connection().attr("stroke",color);return this;},unhighlight:function(){this.connection().attr("stroke",this._opt.attrs.stroke||"#000");return this;}};Joint.currentJoint=null;Joint.paper=function paper(){var p=arguments[0];if(p===undefined){return this._paper;}
this._paperArguments=arguments;if(!(p instanceof global.Raphael)){return(this._paper=global.Raphael.apply(global,arguments));}
return(this._paper=p);};Joint.resetPaper=function resetPaper(){if(!this._paper){return;}
var canvas=this._paper.canvas;canvas.parentNode.removeChild(canvas);Joint.paper.apply(Joint,this._paperArguments);};Joint.getArrow=function(type,size,attrs){if(!size){size=2;}
var arrow=Joint.arrows[type](size);if(!arrow.attrs)arrow.attrs={};if(attrs){for(var key in attrs){arrow.attrs[key]=attrs[key];}}
return arrow;};Joint.arrows={none:function(size){if(!size){size=2;}
return{path:["M",size.toString(),"0","L",(-size).toString(),"0"],dx:size,dy:size};},basic:function(size){if(!size){size=5;}
return{path:["M",size.toString(),"0","L",(-size).toString(),(-size).toString(),"L",(-size).toString(),size.toString(),"z"],dx:size,dy:size,attrs:{stroke:"black",fill:"black"}};}};Joint.findPos=function(el){var p=point(0,0);if(el.offsetParent){while(el){p.offset(el.offsetLeft,el.offsetTop);el=el.offsetParent;}}else{p.offset(el.parentNode.offsetLeft,el.parentNode.offsetTop);}
return p;};Joint.getMousePosition=function(e,el){var pos;if(e.pageX||e.pageY){pos=point(e.pageX,e.pageY);}else{var
docEl=document.documentElement,docBody=document.body;pos=point(e.clientX+(docEl.scrollLeft||docBody.scrollLeft)-docEl.clientLeft,e.clientY+(docEl.scrollTop||docBody.scrollTop)-docEl.clientTop);}
var rp=Joint.findPos(el);return point(pos.x-rp.x,pos.y-rp.y);};Joint.mouseMove=function(e){if(Joint.currentJoint!==null){var joint=Joint.currentJoint;if(joint.state===joint.STARTCAPDRAGGING||joint.state===joint.ENDCAPDRAGGING){joint.capDragging(e);}else if(joint.state===joint.CONNECTIONWIRING){joint.connectionWiring(e);}}};Joint.mouseUp=function(e){if(Joint.currentJoint!==null){var joint=Joint.currentJoint;if(joint.state===joint.STARTCAPDRAGGING||joint.state===joint.ENDCAPDRAGGING){joint.capEndDragging();}}
Joint.currentJoint=null;};Joint.fixEvent=function(event){event.preventDefault=Joint.fixEvent.preventDefault;event.stopPropagation=Joint.fixEvent.stopPropagation;return event;};Joint.fixEvent.preventDefault=function(){this.returnValue=false;};Joint.fixEvent.stopPropagation=function(){this.cancelBubble=true;};Joint.handleEvent=function(event){var returnValue=true;event=event||Joint.fixEvent(((global.ownerDocument||global.document||global).parentWindow||global).event);var handlers=this.events[event.type];for(var i in handlers){this.$$handleEvent=handlers[i];if(this.$$handleEvent(event)===false){returnValue=false;}}
return returnValue;};Joint.addEvent=function(element,type,handler){if(element.addEventListener){element.addEventListener(type,handler,false);}else{if(!handler.$$guid){handler.$$guid=Joint.addEvent.guid++;}
if(!element.events){element.events={};}
var handlers=element.events[type];if(!handlers){handlers=element.events[type]={};if(element["on"+type]){handlers[0]=element["on"+type];}}
handlers[handler.$$guid]=handler;element["on"+type]=Joint.handleEvent;}};Joint.addEvent.guid=1;Joint.removeEvent=function(element,type,handler){if(element.removeEventListener){element.removeEventListener(type,handler,false);}else{if(element.events&&element.events[type]){delete element.events[type][handler.$$guid];}}};Joint.addEvent(document,"mousemove",Joint.mouseMove);Joint.addEvent(document,"mouseup",Joint.mouseUp);var JointDOMBuilder={init:function(paper,opt,start,end,jointLocation,connectionPathCommands,labelLocation){this.paper=paper;this.opt=opt;this.start=start;this.end=end;this.jointLocation=jointLocation;this.connectionPathCommands=connectionPathCommands;this.labelLocation=labelLocation;return this;},dummy:function(startOrEnd,pos,opt){startOrEnd.dummy=true;startOrEnd.shape=this.paper.circle(pos.x,pos.y,opt.radius).attr(opt.attrs);startOrEnd.shape.show();return startOrEnd.shape;},dummyStart:function(){return this.dummy(this.start,this.jointLocation.start.bound,this.opt.dummy.start);},dummyEnd:function(){return this.dummy(this.end,this.jointLocation.end.bound,this.opt.dummy.end);},handleStart:function(){var opt=this.opt.handle.start;if(!opt.enabled)return undefined;var pos=this.jointLocation.start.bound;return this.paper.circle(pos.x,pos.y,opt.radius).attr(opt.attrs);},handleEnd:function(){var opt=this.opt.handle.end;if(!opt.enabled)return undefined;var pos=this.jointLocation.end.bound;return this.paper.circle(pos.x,pos.y,opt.radius).attr(opt.attrs);},connection:function(){var opt=this.opt,con=this.paper.path(this.connectionPathCommands.join(" ")).attr(opt.attrs);con.node.style.cursor=opt.cursor;con.show();return con;},label:function(){if(this.opt.label===undefined)return undefined;var pos=this.labelLocation,labelText=this.paper.text(pos.x,pos.y,this.opt.label).attr(this.opt.labelAttrs),bb=labelText.getBBox(),labelBox=this.paper.rect(bb.x,bb.y,bb.width,bb.height).attr(this.opt.labelBoxAttrs);labelText.insertAfter(labelBox);return{text:labelText,box:labelBox};},startCap:function(){var opt=this.opt.arrow.start,startCap=this.paper.path(opt.path.join(" ")).attr(opt.attrs);startCap.translate(this.jointLocation.start.translate.x,this.jointLocation.start.translate.y);startCap.rotate(this.jointLocation.start.rotate);startCap.show();return startCap;},endCap:function(){var opt=this.opt.arrow.end,endCap=this.paper.path(opt.path.join(" ")).attr(opt.attrs);endCap.translate(this.jointLocation.end.translate.x,this.jointLocation.end.translate.y);endCap.rotate(this.jointLocation.end.rotate);endCap.show();return endCap;}};function Point(x,y){var xy;if(y===undefined){xy=x.split(x.indexOf("@")===-1?" ":"@");this.x=parseInt(xy[0],10);this.y=parseInt(xy[1],10);}else{this.x=x;this.y=y;}}
function point(x,y){return new Point(x,y);}
Point.prototype={constructor:Point,_isPoint:true,toString:function(){return this.x+"@"+this.y;},deepCopy:function(){return point(this.x,this.y);},adhereToRect:function(r){if(r.containsPoint(this)){return this;}
this.x=mmin(mmax(this.x,r.x),r.x+r.width);this.y=mmin(mmax(this.y,r.y),r.y+r.height);return this;},theta:function(p){var y=-(p.y-this.y),x=p.x-this.x,rad=atan2(y,x);if(rad<0){rad=2*PI+rad;}
return{degrees:180*rad/PI,radians:rad};},distance:function(p){return line(this,p).length();},offset:function(dx,dy){this.x+=dx;this.y+=dy;return this;},normalize:function(len){var s=len/sqrt((this.x*this.x)+(this.y*this.y));this.x=s*this.x;this.y=s*this.y;return this;}};Point.fromPolar=function(r,angle){return point(r*cos(angle),r*sin(angle));};function Line(p1,p2){this.start=p1;this.end=p2;}
function line(p1,p2){return new Line(p1,p2);}
Line.prototype={constructor:Line,toString:function(){return"start: "+this.start.toString()+" end:"+this.end.toString();},length:function(){return sqrt(this.squaredLength());},squaredLength:function(){var
x0=this.start.x,y0=this.start.y,x1=this.end.x,y1=this.end.y;return(x0-=x1)*x0+(y0-=y1)*y0;},midpoint:function(){return point((this.start.x+this.end.x)/2,(this.start.y+this.end.y)/2);},intersection:function(l){var pt1Dir=point(this.end.x-this.start.x,this.end.y-this.start.y),pt2Dir=point(l.end.x-l.start.x,l.end.y-l.start.y),det=(pt1Dir.x*pt2Dir.y)-(pt1Dir.y*pt2Dir.x),deltaPt=point(l.start.x-this.start.x,l.start.y-this.start.y),alpha=(deltaPt.x*pt2Dir.y)-(deltaPt.y*pt2Dir.x),beta=(deltaPt.x*pt1Dir.y)-(deltaPt.y*pt1Dir.x);if(det===0||alpha*det<0||beta*det<0){return null;}
if(det>0){if(alpha>det||beta>det){return null;}}else{if(alpha<det||beta<det){return null;}}
return point(this.start.x+(alpha*pt1Dir.x/det),this.start.y+(alpha*pt1Dir.y/det));}};function Rect(o){this.x=o.x;this.y=o.y;this.width=o.width;this.height=o.height;}
function rect(o){if(typeof o.width==="undefined"){return new Rect({x:arguments[0],y:arguments[1],width:arguments[2],height:arguments[3]});}
return new Rect(o);}
Rect.prototype={constructor:Rect,toString:function(){return"origin: "+this.origin().toString()+" corner: "+this.corner().toString();},origin:function(){return point(this.x,this.y);},corner:function(){return point(this.x+this.width,this.y+this.height);},topRight:function(){return point(this.x+this.width,this.y);},bottomLeft:function(){return point(this.x,this.y+this.height);},center:function(){return point(this.x+this.width/2,this.y+this.height/2);},intersect:function(r){var myOrigin=this.origin(),myCorner=this.corner(),rOrigin=r.origin(),rCorner=r.corner();if(rCorner.x<=myOrigin.x){return false;}
if(rCorner.y<=myOrigin.y){return false;}
if(rOrigin.x>=myCorner.x){return false;}
if(rOrigin.y>=myCorner.y){return false;}
return true;},sideNearestToPoint:function(p){var distToLeft=p.x-this.x,distToRight=(this.x+this.width)-p.x,distToTop=p.y-this.y,distToBottom=(this.y+this.height)-p.y,closest=distToLeft,side="left";if(distToRight<closest){closest=distToRight;side="right";}
if(distToTop<closest){closest=distToTop;side="top";}
if(distToBottom<closest){closest=distToBottom;side="bottom";}
return side;},containsPoint:function(p){if(p.x>this.x&&p.x<this.x+this.width&&p.y>this.y&&p.y<this.y+this.height){return true;}
return false;},pointNearestToPoint:function(p){if(this.containsPoint(p)){var side=this.sideNearestToPoint(p);switch(side){case"right":return point(this.x+this.width,p.y);case"left":return point(this.x,p.y);case"bottom":return point(p.x,this.y+this.height);case"top":return point(p.x,this.y);}}else{return p.adhereToRect(this);}},boundPoint:function(p){var center=point(this.x+this.width/2,this.y+this.height/2);var sides=[line(this.origin(),this.topRight()),line(this.topRight(),this.corner()),line(this.corner(),this.bottomLeft()),line(this.bottomLeft(),this.origin())],connector=line(center,p);for(var i=sides.length-1;i>=0;--i){var intersection=sides[i].intersection(connector);if(intersection!==null){return intersection;}}},moveAndExpand:function(r){this.x+=r.x;this.y+=r.y;this.width+=r.width;this.height+=r.height;return this;}};function Ellipse(c,a,b){this.x=c.x;this.y=c.y;this.a=a;this.b=b;}
function ellipse(c,a,b){return new Ellipse(c,a,b);}
Ellipse.prototype={constructor:Ellipse,bbox:function(){return rect({x:this.x-this.a,y:this.y-this.b,width:2*this.a,height:2*this.b});},intersectionWithLineFromCenterToPoint:function(p){var dx=p.x-this.x,dy=p.y-this.y;if(dx===0){return this.bbox().pointNearestToPoint(p);}
var m=dy/dx,mSquared=m*m,aSquared=this.a*this.a,bSquared=this.b*this.b,x=sqrt(1/((1/aSquared)+(mSquared/bSquared)));if(dx<0){x=-x;}
var y=m*x;return point(this.x+x,this.y+y);}};function BezierSegment(p0,p1,p2,p3){this.p0=p0;this.p1=p1;this.p2=p2;this.p3=p3;}
function bezierSegment(p0,p1,p2,p3){return new BezierSegment(p0,p1,p2,p3);}
BezierSegment.prototype={constructor:BezierSegment,getPoint:function(t){var
a=1-t,b=a*a,c=b*a,tt=t*t,ttt=tt*t;return point(c*this.p0.x+3*b*t*this.p1.x+3*a*tt*this.p2.x+ttt*this.p3.x,c*this.p0.y+3*b*t*this.p1.y+3*a*tt*this.p2.y+ttt*this.p3.y);}};function Bezier(){}
Bezier.curveThroughPoints=function(points,z,angleFactor){if(typeof z==="undefined"){z=0.5;}
if(typeof angleFactor==="undefined"){angleFactor=0.75;}
var path=[];if(points.length<2){throw new Error("Points array must have minimum of two points.");}
var p=[points[0]];for(var i=1,len=points.length;i<len;i++){if(points[i].x!=points[i-1].x||points[i].y!=points[i-1].y){p.push(points[i]);}}
if(z<=0){z=0.5;}else if(z>1){z=1;}
if(angleFactor<0){angleFactor=0;}else if(angleFactor>1){angleFactor=1;}
if(p.length>2){var firstPt=1;var lastPt=p.length-1;if(p[0].x==p[lastPt].x&&p[0].y==p[lastPt].y){firstPt=0;lastPt=p.length;}
var controlPts=[];for(var i=firstPt;i<lastPt;i++){var p0=(i-1<0)?p[p.length-2]:p[i-1];var p1=p[i];var p2=(i+1==p.length)?p[1]:p[i+1];var a=p0.distance(p1);if(a<0.001){a=0.001;}
var b=p1.distance(p2);if(b<0.001){b=0.001;}
var c=p0.distance(p2);if(c<0.001){c=0.001;}
var cos=(b*b+a*a-c*c)/(2*b*a);if(cos<-1){cos=-1;}
else if(cos>1){cos=1;}
var C=acos(cos);var aPt=point(p0.x-p1.x,p0.y-p1.y);var bPt=point(p1.x,p1.y);var cPt=point(p2.x-p1.x,p2.y-p1.y);if(a>b){aPt.normalize(b);}else if(b>a){cPt.normalize(a);}
aPt.offset(p1.x,p1.y);cPt.offset(p1.x,p1.y);var ax=bPt.x-aPt.x;var ay=bPt.y-aPt.y;var bx=bPt.x-cPt.x;var by=bPt.y-cPt.y;var rx=ax+bx;var ry=ay+by;if(rx===0&&ry===0){rx=-bx;ry=by;}
if(ay===0&&by===0){rx=0;ry=1;}else if(ax===0&&bx===0){rx=1;ry=0;}
var theta=atan2(ry,rx);var controlDist=mmin(a,b)*z;var controlScaleFactor=C/PI;controlDist*=((1-angleFactor)+angleFactor*controlScaleFactor);var controlAngle=theta+PI/2;var controlPoint2=Point.fromPolar(controlDist,controlAngle);var controlPoint1=Point.fromPolar(controlDist,controlAngle+PI);controlPoint1.offset(p1.x,p1.y);controlPoint2.offset(p1.x,p1.y);if(controlPoint2.distance(p2)>controlPoint1.distance(p2)){controlPts[i]=[controlPoint2,controlPoint1];}else{controlPts[i]=[controlPoint1,controlPoint2];}}
path.push("M",p[0].x,p[0].y);if(firstPt==1){path.push("S",controlPts[1][0].x,controlPts[1][0].y,p[1].x,p[1].y);}
var straightLines=true;for(var i=firstPt;i<lastPt-1;i++){var isStraight=false;if((i>0&&atan2(p[i].y-p[i-1].y,p[i].x-p[i-1].x)==atan2(p[i+1].y-p[i].y,p[i+1].x-p[i].x))||(i<p.length-2&&atan2(p[i+2].y-p[i+1].y,p[i+2].x-p[i+1].x)==atan2(p[i+1].y-p[i].y,p[i+1].x-p[i].x))){isStraight=true;}
if(straightLines&&isStraight){path.push("L",p[i+1].x,p[i+1].y);}else{var bezier=bezierSegment(p[i],controlPts[i][1],controlPts[i+1][0],p[i+1]);for(var t=0.01;t<1.01;t+=0.01){var val=bezier.getPoint(t);path.push("L",val.x,val.y);}}}
if(lastPt==p.length-1){path.push("S",controlPts[i][1].x,controlPts[i][1].y,p[i+1].x,p[i+1].y);}}else if(p.length==2){path.push("M",p[0].x,p[0].y);path.push("L",p[1].x,p[1].y);}
return path;};Joint.Point=Point;Joint.point=point;Joint.Rect=Rect;Joint.rect=rect;Joint.Line=Line;Joint.line=line;Joint.Ellipse=Ellipse;Joint.ellipse=ellipse;Joint.BezierSegment=BezierSegment;Joint.bezierSegment=bezierSegment;Joint.Bezier=Bezier;var _attr=global.Raphael.el.attr;global.Raphael.el.attr=function(){if((arguments.length==1&&(typeof arguments[0]==="string"||typeof arguments[0]==="array"))||(typeof this.joints==="undefined")){return _attr.apply(this,arguments);}
var o={};for(var key in this.attrs){o[key]=this.attrs[key];}
_attr.apply(this,arguments);var
n=this.attrs,positionChanged=false,strokeChanged=false;if(o.x!=n.x||o.y!=n.y||o.cx!=n.cx||o.cy!=n.cy||o.path!=n.path||o.r!=n.r){positionChanged=true;}
if(o.stroke!=n.stroke){strokeChanged=true;}
for(var i=this.joints().length-1;i>=0;--i){var joint=this.joints()[i];if(positionChanged){joint.update();joint.callback("objectMoving",joint,[this]);}}
return this;};global.Raphael.el.joint=function(to,opt){Joint.paper(this.paper);return new Joint(this,to,opt);};global.Raphael.el.euid=function(){return Joint.generateEuid.call(this);};global.Raphael.el.yourself=function(){return this;};global.Raphael.el.joints=function(){return(this._joints||(this._joints=[]));};global.Raphael.fn.euid=function(){return Joint.generateEuid.call(this);};})(this);/**
 * Joint 0.2 - JavaScript diagramming library.
 * Copyright (c) David Durman 2009 - 2010
 * Licensed under the MIT license: (http://www.opensource.org/licenses/mit-license.php)
 */

(function(global){var Joint=global.Joint;var point=Joint.point;var rect=Joint.rect;var dia=Joint.dia={_currentDrag:false,_currentZoom:false,_registeredObjects:{},_registeredJoints:{},Joint:function(args){var j=Joint.apply(null,arguments);this.registerJoint(j);return j;},registeredElements:function(){return(this._registeredObjects[Joint.paper().euid()]||(this._registeredObjects[Joint.paper().euid()]=[]));},registeredJoints:function(){return(this._registeredJoints[Joint.paper().euid()]||(this._registeredJoints[Joint.paper().euid()]=[]));},register:function(obj){(this._registeredObjects[Joint.paper().euid()]||(this._registeredObjects[Joint.paper().euid()]=[])).push(obj);},unregister:function(obj){var register=(this._registeredObjects[Joint.paper().euid()]||(this._registeredObjects[Joint.paper().euid()]=[])),idx=register.length;while(idx--)
if(register[idx]===obj)
register.splice(idx,1);},registerJoint:function(j){(this._registeredJoints[Joint.paper().euid()]||(this._registeredJoints[Joint.paper().euid()]=[])).push(j);},unregisterJoint:function(j){var register=(this._registeredJoints[Joint.paper().euid()]||(this._registeredJoints[Joint.paper().euid()]=[])),idx=register.length;while(idx--)
if(register[idx]===j)
register.splice(idx,1);}};var Element=dia.Element=function(){};var Mixin=Joint.Mixin=function(){var target=arguments[0];for(var i=1,l=arguments.length;i<l;i++){var extension=arguments[i];for(var key in extension){if(!extension.hasOwnProperty(key)){continue;}
var copy=extension[key];if(copy===target[key]){continue;}
if(typeof copy=="function"&&typeof target[key]=="function"&&!copy.base){copy.base=target[key];}
target[key]=copy;}}
return target;};var Supplement=Joint.Supplement=function(){var target=arguments[0];for(var i=1,l=arguments.length;i<l;i++){var extension=arguments[i];for(var key in extension){var copy=extension[key];if(copy===target[key]){continue;}
if(typeof copy=="function"&&typeof target[key]=="function"&&!target[key].base){target[key].base=copy;}
if(!target.hasOwnProperty(key)&&extension.hasOwnProperty(key)){target[key]=copy;}}}
return target;};Element.create=function(properties){var instance=new this(properties);if(instance.init){instance.init(properties);instance.paper.safari();}
return instance;};Element.extend=function(prototype){var C=prototype.constructor=function(properties){this.construct(properties);};C.base=this;var proto=C.prototype=new this();Mixin(proto,prototype);Supplement(C,this);return C;};Element.prototype={parentElement:null,toolbox:null,_isElement:true,lastScaleX:1.0,lastScaleY:1.0,dx:undefined,dy:undefined,origBBox:undefined,construct:function(properties){this.properties={dx:0,dy:0,rot:0,sx:1.0,sy:1.0,module:this.module,object:this.object,parent:properties.parent};this.wrapper=null;this.inner=[];this.ghostAttrs={opacity:0.5,"stroke-dasharray":"-",stroke:"black"};this._opt={draggable:true,ghosting:false,toolbox:false};this.paper=Joint.paper();dia.register(this);},euid:function(){return Joint.generateEuid.call(this);},joints:function(){return this.wrapper.joints();},yourself:function(){return this.wrapper;},updateJoints:function(){var joints=this.wrapper.joints();if(joints){for(var i=0,l=joints.length;i<l;i++){joints[i].update();}}},toggleGhosting:function(){this._opt.ghosting=!this._opt.ghosting;return this;},createGhost:function(){var
wa=this.wrapper.attrs,paper=this.wrapper.paper;switch(this.wrapper.type){case"rect":this.ghost=paper.rect(wa.x,wa.y,wa.width,wa.height,wa.r);break;case"circle":this.ghost=paper.circle(wa.cx,wa.cy,wa.r);break;case"ellipse":this.ghost=paper.ellipse(wa.cx,wa.cy,wa.rx,wa.ry);break;default:break;}
this.ghost.attr(this.ghostAttrs);},objPos:function(objname){switch(this[objname].type){case"rect":return point(this[objname].attr("x"),this[objname].attr("y"));case"circle":case"ellipse":return point(this[objname].attr("cx"),this[objname].attr("cy"));default:break;}},wrapperPos:function(){return this.objPos("wrapper");},ghostPos:function(){return this.objPos("ghost");},toFront:function(){this.wrapper&&this.wrapper.toFront();for(var i=0,len=this.inner.length;i<len;i++)
this.inner[i].toFront();return this;},toBack:function(){for(var i=this.inner.length-1;i<=0;--i)
this.inner[i].toBack();this.wrapper&&this.wrapper.toBack();return this;},dragger:function(e){if(!this.wholeShape._opt.draggable)return;dia._currentDrag=this.wholeShape;if(dia._currentDrag._opt.ghosting){dia._currentDrag.createGhost();dia._currentDrag.ghost.toFront();}else
dia._currentDrag.toFront();dia._currentDrag.removeToolbox();dia._currentDrag.translate(1,1);dia._currentDrag.dx=e.clientX;dia._currentDrag.dy=e.clientY;e.preventDefault&&e.preventDefault();},resize:function(dx,dy){var newWidth=this.attr("width")+dx;var newHeight=this.attr("height")+dy;var newRadius=this.attr("r")+dx;if(this.wrapper.type=="rect"){if(newWidth<=1||newHeight<=1){return this;}
this.attr("width",newWidth);this.attr("height",newHeight);this.properties.rect.width=newWidth;this.properties.rect.height=newHeight;}else if(this.wrapper.type=="circle"){if(newRadius<=1){return this;}
this.attr("r",newRadius);this.properties.radius=newRadius;}
this.recover();return this;},recover:function(){},zoomer:function(e){dia._currentZoom=this;dia._currentZoom.toFront();dia._currentZoom.removeToolbox();dia._currentZoom.dx=e.clientX;dia._currentZoom.dy=e.clientY;e.preventDefault&&e.preventDefault();},translate:function(dx,dy){this.properties.dx+=dx;this.properties.dy+=dy;this.wrapper.translate(dx,dy);for(var i=this.inner.length-1;i>=0;--i){this.inner[i].translate(dx,dy);}
this.translateToolbox(dx,dy);this.paper.safari();},setWrapper:function(s){this.wrapper=s;this.wrapper.wholeShape=this;this.type=this.wrapper.type;this.origBBox=this.wrapper.getBBox();if(this._opt&&this._opt.draggable){this.wrapper.mousedown(this.dragger);this.wrapper.node.style.cursor="move";}
if(!this.wrapper.joints){this.wrapper._joints=[];this.wrapper.joints=function(){return this._joints;};}
this.addToolbox();return this;},addInner:function(s){this.inner.push(s);s.wholeShape=this;s.parentElement=this;if(s._isElement)s.properties.parent=this.euid();if(!s._isElement&&this._opt&&this._opt.draggable){s.mousedown(this.dragger);s.node.style.cursor="move";}
s.toFront();return this;},delInner:function(s){var
i=0,len=this.inner.length;for(;i<len;i++)
if(this.inner[i]==s)
break;if(i<len){this.inner.splice(i,1);s.parentElement=null;if(s._isElement)s.properties.parent=undefined;}
return this;},addToolbox:function(){if(!this._opt.toolbox){return this;}
var self=this,bb=this.wrapper.getBBox();this.toolbox=[];var zoomSign=this.paper.path("M0,0L7,7L0,14z").attr({fill:"#000",stroke:"none"});this.toolbox.push(zoomSign);zoomSign.translate(bb.x+bb.width+3,bb.y+bb.height-3);zoomSign.rotate(45);zoomSign.node.style.cursor="se-resize";zoomSign.toFront();Joint.addEvent(zoomSign.node,"mousedown",function(e){dia.Element.prototype.zoomer.apply(self,[e]);});var upArrow=this.paper.path("M16,1.466C7.973,1.466,1.466,7.973,1.466,16c0,8.027,6.507,14.534,14.534,14.534c8.027,0,14.534-6.507,14.534-14.534C30.534,7.973,24.027,1.466,16,1.466zM13.665,25.725l-3.536-3.539l6.187-6.187l-6.187-6.187l3.536-3.536l9.724,9.723L13.665,25.725z").attr({fill:"#000",stroke:"none"});this.toolbox.push(upArrow);upArrow.scale(1/3);upArrow.translate(bb.x-25,bb.y-20);upArrow.rotate(-90);upArrow.toFront();upArrow.node.onclick=function(){self.embed();};var downArrow=this.paper.path("M16,1.466C7.973,1.466,1.466,7.973,1.466,16c0,8.027,6.507,14.534,14.534,14.534c8.027,0,14.534-6.507,14.534-14.534C30.534,7.973,24.027,1.466,16,1.466zM13.665,25.725l-3.536-3.539l6.187-6.187l-6.187-6.187l3.536-3.536l9.724,9.723L13.665,25.725z").attr({fill:"#000",stroke:"none"});this.toolbox.push(downArrow);downArrow.scale(1/3);downArrow.translate(bb.x-25,bb.y-8);downArrow.rotate(90);downArrow.toFront();downArrow.node.onclick=function(){self.unembed();};var cross=this.paper.path("M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248").attr({fill:"black",stroke:"none"});this.toolbox.push(cross);cross.scale(1/2);cross.translate(bb.x+bb.width-10,bb.y-18);cross.toFront();cross.node.onclick=function(){self.remove();};var cloneSign=this.paper.path("M28.952,12.795c-0.956,1.062-5.073,2.409-5.604,2.409h-4.513c-0.749,0-1.877,0.147-2.408,0.484c0.061,0.054,0.122,0.108,0.181,0.163c0.408,0.379,1.362,0.913,2.206,0.913c0.397,0,0.723-0.115,1-0.354c1.178-1.007,1.79-1.125,2.145-1.125c0.421,0,0.783,0.193,0.996,0.531c0.4,0.626,0.106,1.445-0.194,2.087c-0.718,1.524-3.058,3.171-5.595,3.171c-0.002,0-0.002,0-0.004,0c-0.354,0-0.701-0.033-1.033-0.099v3.251c0,0.742,1.033,2.533,4.167,2.533s3.955-3.701,3.955-4.338v-4.512c2.23-1.169,4.512-1.805,5.604-3.895C30.882,12.05,29.907,11.733,28.952,12.795zM21.942,17.521c0.796-1.699-0.053-1.699-1.54-0.425s-3.665,0.105-4.408-0.585c-0.743-0.689-1.486-1.22-2.814-1.167c-1.328,0.053-4.46-0.161-6.267-0.585c-1.805-0.425-4.895-3-5.15-2.335c-0.266,0.69,0.211,1.168,1.168,2.335c0.955,1.169,5.075,2.778,5.075,2.778s0,3.453,0,4.886c0,1.435,2.973,3.61,4.512,3.61s2.708-1.062,2.708-1.806v-4.512C17.775,21.045,21.146,19.221,21.942,17.521zM20.342,13.73c1.744,0,3.159-1.414,3.159-3.158c0-1.745-1.415-3.159-3.159-3.159s-3.158,1.414-3.158,3.159C17.184,12.316,18.598,13.73,20.342,13.73zM12.019,13.73c1.744,0,3.158-1.414,3.158-3.158c0-1.745-1.414-3.159-3.158-3.159c-1.745,0-3.159,1.414-3.159,3.159C8.86,12.316,10.273,13.73,12.019,13.73z").attr({fill:"#000",stroke:"black"});this.toolbox.push(cloneSign);cloneSign.scale(1/2);cloneSign.translate(bb.x-25,bb.y+bb.height-15);cloneSign.toFront();cloneSign.node.onclick=function(){dia._currentDrag=self.clone();};return this;},removeToolbox:function(){if(this.toolbox)
for(var i=this.toolbox.length-1;i>=0;--i)
this.toolbox[i].remove();this.toolbox=null;return this;},toggleToolbox:function(enable){this._opt.toolbox=(enable!==undefined)?enable:!this._opt.toolbox;if(this._opt.toolbox){this.addToolbox();}else{this.removeToolbox();}
return this;},translateToolbox:function(dx,dy){if(this.toolbox)
for(var i=this.toolbox.length-1;i>=0;--i)
this.toolbox[i].translate(dx,dy);},disconnect:function(){var joints=this.joints(),idx=joints.length,j;while(idx--){j=joints[idx];if(j.endObject().wholeShape===this){j.freeJoint(j.endObject());j.draw(["dummyEnd"]);j.update();}
if(j.startObject().wholeShape===this){j.freeJoint(j.startObject());j.draw(["dummyStart"]);j.update();}}},unregisterFromJoints:function(){var joints=this.joints(),idx=joints.length;while(idx--)joints[idx].unregister(this);return this;},remove:function(){var inners=this.inner,idx=inners.length;this.unregisterFromJoints();this.disconnect();this.removeToolbox();this.unembed();while(idx--)inners[idx].remove();this.wrapper.remove();dia.unregister(this);this.removed=true;return null;},liquidate:function(){var joints=this.joints(),idx=joints.length,j,inners=this.inner;while(idx--){j=joints[idx];j.freeJoint(j.startObject());j.freeJoint(j.endObject());j.clean(["connection","startCap","endCap","handleStart","handleEnd","label"]);dia.unregisterJoint(j);j.unregister(this);}
this.removeToolbox();this.unembed();idx=inners.length;while(idx--){if(inners[idx].liquidate)inners[idx].liquidate();else inners[idx].remove();}
this.wrapper.remove();dia.unregister(this);this.removed=true;return null;},draggable:function(enable){this._opt.draggable=enable;this.wrapper.node.style.cursor=enable?"move":null;var idx=this.inner.length;while(idx--)this.inner[idx].node.style.cursor=enable?"move":null;return this;},highlight:function(){this.wrapper.attr("stroke","red");return this;},unhighlight:function(){this.wrapper.attr("stroke",this.properties.attrs.stroke||"#000");return this;},embed:function(){var
ros=dia._registeredObjects[this.paper.euid()],myBB=rect(this.wrapper.getBBox()),embedTo=null;for(var i=0,len=ros.length;i<len;i++){var
shape=ros[i],shapeBB=rect(shape.getBBox());if(shapeBB.containsPoint(myBB.origin()))
embedTo=shape;if(shape==this.parentElement){shape.delInner(this);if(embedTo)break;}}
embedTo&&embedTo.addInner(this);return this;},unembed:function(){if(this.parentElement){this.parentElement.delInner(this);this.parentElement=null;this.properties.parent=undefined;}
return this;},scale:function(sx,sy){this.properties.sx=sx;this.properties.sy=sy;this.wrapper.scale.apply(this.wrapper,arguments);this.zoom.apply(this,arguments);for(var i=0,len=this.inner.length;i<len;i++){var inner=this.inner[i];if(inner._isElement){inner.scale.apply(inner,arguments);}}
if(this._doNotRedrawToolbox)return;this.removeToolbox();this.addToolbox();},zoom:function(sx,sy){},getBBox:function(){return this.wrapper.getBBox();},joint:function(to,opt){var toobj=(to._isElement)?to.wrapper:to,j=this.wrapper.joint.apply(this.wrapper,[toobj,opt]);Joint.dia.registerJoint(j);return j;},attr:function(){return Raphael.el.attr.apply(this.wrapper,arguments);}};Element.mouseMove=function(e){e=e||window.event;if(dia._currentDrag){if(dia._currentDrag._opt.ghosting)
dia._currentDrag.ghost.translate(e.clientX-dia._currentDrag.dx,e.clientY-dia._currentDrag.dy);else
dia._currentDrag.translate(e.clientX-dia._currentDrag.dx,e.clientY-dia._currentDrag.dy);dia._currentDrag.dx=e.clientX;dia._currentDrag.dy=e.clientY;}
if(dia._currentZoom){var
dx=e.clientX-dia._currentZoom.dx,dy=e.clientY-dia._currentZoom.dy;dia._currentZoom.resize(dx,dy);dia._currentZoom.dx=e.clientX;dia._currentZoom.dy=e.clientY;}};Element.mouseUp=function(e){if(dia._currentDrag&&dia._currentDrag._opt.ghosting){var
gPos=dia._currentDrag.ghostPos(),wPos=dia._currentDrag.wrapperPos();dia._currentDrag.translate(gPos.x-wPos.x,gPos.y-wPos.y);dia._currentDrag.ghost.remove();dia._currentDrag.updateJoints();}
if(dia._currentDrag){dia._currentDrag.addToolbox();dia._currentDrag.toFront();dia._currentDrag.translate(1,1);}
if(dia._currentZoom&&dia._currentZoom._opt.ghosting){}
if(dia._currentZoom){dia._currentZoom.removeToolbox();dia._currentZoom.addToolbox();dia._currentZoom.toFront();}
dia._currentDrag=false;dia._currentZoom=false;};Joint.addEvent(document,"mousemove",Element.mouseMove);Joint.addEvent(document,"mouseup",Element.mouseUp);})(this);/**
 * Joint 0.2 - JavaScript diagramming library.
 * Copyright (c) David Durman 2009 - 2010
 * Licensed under the MIT license: (http://www.opensource.org/licenses/mit-license.php)
 */

(function(global){var Joint=global.Joint,Element=Joint.dia.Element,point=Joint.point;var uml=Joint.dia.uml={};Joint.arrows.aggregation=function(size){return{path:["M","7","0","L","0","5","L","-7","0","L","0","-5","z"],dx:9,dy:9,attrs:{stroke:"black","stroke-width":2.0,fill:"black"}};};uml.aggregationArrow={endArrow:{type:"aggregation"},startArrow:{type:"none"},attrs:{"stroke-dasharray":"none"}};uml.dependencyArrow={endArrow:{type:"basic",size:5},startArrow:{type:"none"},attrs:{"stroke-dasharray":"none"}};uml.generalizationArrow={endArrow:{type:"basic",size:10,attrs:{fill:"white"}},startArrow:{type:"none"},attrs:{"stroke-dasharray":"none"}};uml.arrow={startArrow:{type:"none"},endArrow:{type:"basic",size:5},attrs:{"stroke-dasharray":"none"}};uml.State=Element.extend({object:"State",module:"uml",init:function(properties){var p=this.properties;var rect=p.rect=properties.rect;var radius=p.radius=properties.radius||15;var attrs=p.attrs=properties.attrs||{};if(!p.attrs.fill){p.attrs.fill="white";}
p.label=properties.label||"";p.labelOffsetX=properties.labelOffsetX||20;p.labelOffsetY=properties.labelOffsetY||5;p.swimlaneOffsetY=properties.swimlaneOffsetY||18;if(!properties.actions){properties.actions={};}
p.actions={entry:properties.actions.entry||null,exit:properties.actions.exit||null,inner:properties.actions.inner||[]};p.actionsOffsetX=properties.actionsOffsetX||5;p.actionsOffsetY=properties.actionsOffsetY||5;this.setWrapper(this.paper.rect(rect.x,rect.y,rect.width,rect.height,radius).attr(attrs));this.addInner(this.getLabelElement());this.addInner(this.getSwimlaneElement());this.addInner(this.getActionsElement());},getLabelElement:function(){var
p=this.properties,bb=this.wrapper.getBBox(),t=this.paper.text(bb.x,bb.y,p.label),tbb=t.getBBox();t.translate(bb.x-tbb.x+p.labelOffsetX,bb.y-tbb.y+p.labelOffsetY);return t;},getSwimlaneElement:function(){var bb=this.wrapper.getBBox(),p=this.properties;return this.paper.path(["M",bb.x,bb.y+p.labelOffsetY+p.swimlaneOffsetY,"L",bb.x+bb.width,bb.y+p.labelOffsetY+p.swimlaneOffsetY].join(" "));},getActionsElement:function(){var p=this.properties;var str=(p.actions.entry)?"entry/ "+p.actions.entry+"\n":"";str+=(p.actions.exit)?"exit/ "+p.actions.exit+"\n":"";var l=p.actions.inner.length;for(var i=0;i<l;i+=2){str+=p.actions.inner[i]+"/ "+p.actions.inner[i+1]+"\n";}
str=str.replace(/^\s\s*/,'').replace(/\s\s*$/,'');var
bb=this.wrapper.getBBox(),t=this.paper.text(bb.x+p.actionsOffsetX,bb.y+p.labelOffsetY+p.swimlaneOffsetY+p.actionsOffsetY,str),tbb=t.getBBox();t.attr("text-anchor","start");t.translate(0,tbb.height/2);return t;},zoom:function(){this.wrapper.attr("r",this.properties.radius);this.recover();},recover:function(){this.inner[0].remove();this.inner[1].remove();this.inner[2].remove();this.inner[0]=this.getLabelElement();this.inner[1]=this.getSwimlaneElement();this.inner[2]=this.getActionsElement();}});uml.StartState=Element.extend({object:"StartState",module:"uml",init:function(properties){var p=this.properties;p.position=properties.position||point(0,0);p.radius=properties.radius||10;p.attrs=properties.attrs||{};if(!p.attrs.fill){p.attrs.fill="black";}
this.setWrapper(this.paper.circle(p.position.x,p.position.y,p.radius).attr(p.attrs));}});uml.EndState=Element.extend({object:"EndState",module:"uml",init:function(properties){var p=this.properties;p.position=properties.position||point(0,0);p.radius=properties.radius||10;p.innerRadius=properties.innerRadius||(p.radius/2);this.radiusRatio=p.innerRadius/p.radius;p.attrs=properties.attrs||{};if(!p.attrs.fill){p.attrs.fill="white";}
p.innerAttrs=properties.innerAttrs||{};if(!p.innerAttrs.fill){p.innerAttrs.fill="black";}
this.setWrapper(this.paper.circle(p.position.x,p.position.y,p.radius).attr(p.attrs));this.addInner(this.paper.circle(p.position.x,p.position.y,p.innerRadius).attr(p.innerAttrs));},zoom:function(){this.inner[0].scale.apply(this.inner[0],arguments);},recover:function(){var bb=this.wrapper.getBBox();this.inner[0].remove();this.properties.innerRadius=this.properties.radius*this.radiusRatio;this.inner[0]=this.paper.circle(bb.x+bb.width/2,bb.y+bb.height/2,this.properties.innerRadius).attr(this.properties.innerAttrs);}});uml.Class=Element.extend({object:"Class",module:"uml",init:function(properties){var p=this.properties;var rect=p.rect=properties.rect;var attrs=p.attrs=properties.attrs||{};if(!attrs.fill){attrs.fill="white";}
p.label=properties.label||"";p.labelOffsetX=properties.labelOffsetX||20;p.labelOffsetY=properties.labelOffsetY||5;p.swimlane1OffsetY=properties.swimlane1OffsetY||18;p.swimlane2OffsetY=properties.swimlane2OffsetY||18;p.attributes=properties.attributes||[];p.attributesOffsetX=properties.attributesOffsetX||5;p.attributesOffsetY=properties.attributesOffsetY||5;p.methods=properties.methods||[];p.methodsOffsetX=properties.methodsOffsetX||5;p.methodsOffsetY=properties.methodsOffsetY||5;this.setWrapper(this.paper.rect(rect.x,rect.y,rect.width,rect.height).attr(attrs));this.addInner(this.getLabelElement());this.addInner(this.getSwimlane1Element());this.addInner(this.getAttributesElement());this.addInner(this.getSwimlane2Element());this.addInner(this.getMethodsElement());},getLabelElement:function(){var
p=this.properties,bb=this.wrapper.getBBox(),t=this.paper.text(bb.x,bb.y,p.label),tbb=t.getBBox();t.translate(bb.x-tbb.x+p.labelOffsetX,bb.y-tbb.y+p.labelOffsetY);return t;},getSwimlane1Element:function(){var bb=this.wrapper.getBBox(),p=this.properties;return this.paper.path(["M",bb.x,bb.y+p.labelOffsetY+p.swimlane1OffsetY,"L",bb.x+bb.width,bb.y+p.labelOffsetY+p.swimlane1OffsetY].join(" "));},getSwimlane2Element:function(){var
p=this.properties,bb=this.wrapper.getBBox(),bbAtrrs=this.inner[2].getBBox();return this.paper.path(["M",bb.x,bb.y+p.labelOffsetY+p.swimlane1OffsetY+bbAtrrs.height+p.swimlane2OffsetY,"L",bb.x+bb.width,bb.y+p.labelOffsetY+p.swimlane1OffsetY+bbAtrrs.height+p.swimlane2OffsetY].join(" "));},getAttributesElement:function(){var str=" ",p=this.properties;for(var i=0,len=p.attributes.length;i<len;i++){str+=p.attributes[i]+"\n";}
str=str.replace(/^\s\s*/,'').replace(/\s\s*$/,'');var
bb=this.wrapper.getBBox(),t=this.paper.text(bb.x+p.attributesOffsetX,bb.y+p.labelOffsetY+p.swimlane1OffsetY+p.attributesOffsetY,str),tbb=t.getBBox();t.attr("text-anchor","start");t.translate(0,tbb.height/2);return t;},getMethodsElement:function(){var str=" ",p=this.properties;for(var i=0,len=p.methods.length;i<len;i++){str+=p.methods[i]+"\n";}
str=str.replace(/^\s\s*/,'').replace(/\s\s*$/,'');var
bb=this.wrapper.getBBox(),bbAtrrs=this.inner[2].getBBox(),t=this.paper.text(bb.x+p.methodsOffsetX,bb.y+p.labelOffsetY+p.swimlane1OffsetY+p.attributesOffsetY+bbAtrrs.height+p.swimlane2OffsetY+p.methodsOffsetY,str),tbb=t.getBBox();t.attr("text-anchor","start");t.translate(0,tbb.height/2);return t;},zoom:function(){this.recover();},recover:function(){this.inner[0].remove();this.inner[1].remove();this.inner[2].remove();this.inner[3].remove();this.inner[4].remove();this.inner[0]=this.getLabelElement();this.inner[1]=this.getSwimlane1Element();this.inner[2]=this.getAttributesElement();this.inner[3]=this.getSwimlane2Element();this.inner[4]=this.getMethodsElement();}});})(this);/**
 * Joint 0.2 - JavaScript diagramming library.
 * Copyright (c) David Durman 2009 - 2010
 * Licensed under the MIT license: (http://www.opensource.org/licenses/mit-license.php)
 */

(function(global){var Joint=global.Joint,Element=Joint.dia.Element,point=Joint.point;var fsa=Joint.dia.fsa={};fsa.arrow={startArrow:{type:"none"},endArrow:{type:"basic",size:5},attrs:{"stroke-dasharray":"none"}};fsa.State=Element.extend({object:"State",module:"fsa",init:function(properties){var p=this.properties;p.position=properties.position||point(0,0);p.radius=properties.radius||30;p.label=properties.label||"State";p.labelOffsetX=properties.labelOffsetX||(p.radius/2);p.labelOffsetY=properties.labelOffsetY||(p.radius/2+8);p.attrs=properties.attrs||{};if(!p.attrs.fill){p.attrs.fill="white";}
this.setWrapper(this.paper.circle(p.position.x,p.position.y,p.radius).attr(p.attrs));this.addInner(this.getLabelElement());},getLabelElement:function(){var
p=this.properties,bb=this.wrapper.getBBox(),t=this.paper.text(bb.x,bb.y,p.label),tbb=t.getBBox();t.translate(bb.x-tbb.x+p.labelOffsetX,bb.y-tbb.y+p.labelOffsetY);return t;}});fsa.StartState=Element.extend({object:"StartState",module:"fsa",init:function(properties){var p=this.properties;p.position=properties.position||point(0,0);p.radius=properties.radius||10;p.attrs=properties.attrs||{};if(!p.attrs.fill){p.attrs.fill="black";}
this.setWrapper(this.paper.circle(p.position.x,p.position.y,p.radius).attr(p.attrs));}});fsa.EndState=Element.extend({object:"EndState",module:"fsa",init:function(properties){var p=this.properties;p.position=properties.position||point(0,0);p.radius=properties.radius||10;p.innerRadius=properties.innerRadius||(p.radius/2);p.attrs=properties.attrs||{};if(!p.attrs.fill){p.attrs.fill="white";}
p.innerAttrs=properties.innerAttrs||{};if(!p.innerAttrs.fill){p.innerAttrs.fill="black";}
this.setWrapper(this.paper.circle(p.position.x,p.position.y,p.radius).attr(p.attrs));this.addInner(this.paper.circle(p.position.x,p.position.y,p.innerRadius).attr(p.innerAttrs));},zoom:function(){this.inner[0].scale.apply(this.inner[0],arguments);}});})(this);/**
 * Joint 0.2 - JavaScript diagramming library.
 * Copyright (c) David Durman 2009 - 2010
 * Licensed under the MIT license: (http://www.opensource.org/licenses/mit-license.php)
 */

(function(global){var Joint=global.Joint,Element=Joint.dia.Element;var pn=Joint.dia.pn={};pn.arrow={startArrow:{type:"none"},endArrow:{type:"basic",size:5},attrs:{"stroke-dasharray":"none"}};pn.Place=Element.extend({object:"Place",module:"pn",init:function(properties){var p=this.properties;var position=p.position=properties.position;var radius=p.radius=properties.radius||20;var tokenRadius=p.tokenRadius=properties.tokenRadius||3;var tokens=p.tokens=parseInt(properties.tokens)||0;var label=p.label=properties.label;var attrs=p.attrs=properties.attrs||{};if(!attrs.fill){attrs.fill="white";}
var tokenAttrs=p.tokenAttrs=properties.tokenAttrs||{};if(!tokenAttrs.fill){tokenAttrs.fill="black";}
var paper=this.paper;this.setWrapper(paper.circle(position.x,position.y,radius).attr(attrs));var strut=2;switch(tokens){case 0:break;case 1:this.addInner(paper.circle(position.x,position.y,tokenRadius).attr(tokenAttrs));break;case 2:this.addInner(paper.circle(position.x-(tokenRadius*2),position.y,tokenRadius).attr(tokenAttrs));this.addInner(paper.circle(position.x+(tokenRadius*2),position.y,tokenRadius).attr(tokenAttrs));break;case 3:this.addInner(paper.circle(position.x-(tokenRadius*2)-strut,position.y,tokenRadius).attr(tokenAttrs));this.addInner(paper.circle(position.x+(tokenRadius*2)+strut,position.y,tokenRadius).attr(tokenAttrs));this.addInner(paper.circle(position.x,position.y,tokenRadius).attr(tokenAttrs));break;default:this.addInner(paper.text(position.x,position.y,tokens.toString()));break;}
if(label){this.addInner(paper.text(position.x,position.y-radius,label));this.inner[this.inner.length-1].translate(0,-this.inner[this.inner.length-1].getBBox().height);}},zoom:function(){for(var i=0,len=this.inner.length;i<len;i++){this.inner[i].scale.apply(this.inner[i],arguments);}
if(this.label){this.inner[this.inner.length-1].remove();var bb=this.wrapper.getBBox();this.inner[this.inner.length-1]=this.paper.text(bb.x,bb.y,this.properties.label);this.inner[this.inner.length-1].translate(0,-this.inner[this.inner.length-1].getBBox().height);}}});pn.Event=Element.extend({object:"Event",module:"pn",init:function(properties){var p=this.properties;var rect=p.rect=properties.rect;var attrs=p.attrs=properties.attrs||{};if(!attrs.fill){attrs.fill="black";}
if(!attrs.stroke){attrs.stroke="black";}
var label=p.label=properties.label;var paper=this.paper;this.setWrapper(paper.rect(rect.x,rect.y,rect.width,rect.height).attr(attrs));if(label){this.addInner(paper.text(rect.x,rect.y,label));this.inner[0].translate(0,-this.inner[0].getBBox().height);}},zoom:function(){if(this.label){this.inner[0].remove();var bb=this.wrapper.getBBox();this.inner[0]=this.paper.text(bb.x,bb.y,this.properties.label);this.inner[0].translate(0,-this.inner[0].getBBox().height);}}});})(this);/**
 * Joint 0.2 - JavaScript diagramming library.
 * Copyright (c) David Durman 2009 - 2010
 * Licensed under the MIT license: (http://www.opensource.org/licenses/mit-license.php)
 */

(function(global){var Joint=global.Joint,Element=Joint.dia.Element;var devs=Joint.dia.devs={};devs.arrow={endArrow:{type:"none"},startArrow:{type:"none"},attrs:{"stroke-dasharray":"none"}};devs.Model=Element.extend({object:"Model",module:"devs",init:function(properties){var p=this.properties;var rect=p.rect=properties.rect;var attrs=p.attrs=properties.attrs||{};var label=p.label=properties.label;p.labelOffsetX=properties.labelOffsetX||20;p.labelOffsetY=properties.labelOffsetY||5;p.portsOffsetX=properties.portsOffsetX||5;p.portsOffsetY=properties.portsOffsetY||20;p.iPortRadius=properties.iPortRadius||5;p.oPortRadius=properties.oPortRadius||5;p.iPortAttrs=properties.iPortAttrs||{};if(!p.iPortAttrs.fill){p.iPortAttrs.fill="green";}
if(!p.iPortAttrs.stroke){p.iPortAttrs.stroke="black";}
p.oPortAttrs=properties.oPortAttrs||{};if(!p.oPortAttrs.fill){p.oPortAttrs.fill="red";}
if(!p.oPortAttrs.stroke){p.oPortAttrs.stroke="black";}
p.iPortLabelOffsetX=properties.iPortLabelOffsetX||-10;p.iPortLabelOffsetY=properties.iPortLabelOffsetY||-10;p.oPortLabelOffsetX=properties.oPortLabelOffsetX||10;p.oPortLabelOffsetY=properties.oPortLabelOffsetY||-10;var iPorts=p.iPorts=properties.iPorts||[];var oPorts=p.oPorts=properties.oPorts||[];var paper=this.paper;this.setWrapper(paper.rect(rect.x,rect.y,rect.width,rect.height).attr(attrs));this.addInner(this.getLabelElement());for(var i=0,l=iPorts.length;i<l;i++){this.addInner(this.getPortElement("i",i+1,iPorts[i]));}
for(var i=0,l=oPorts.length;i<l;i++){this.addInner(this.getPortElement("o",i+1,oPorts[i]));}
p.iPorts=p.oPorts=p.portsOffsetX=p.portsOffsetY=p.iPortRadius=p.oPortRadius=p.iPortAttrs=p.oPortAttrs=p.iPortLabelOffsetX=p.iPortLabelOffsetY=p.oPortLabelOffsetX=p.oPortLabelOffsetY=undefined;},getLabelElement:function(){var
p=this.properties,bb=this.wrapper.getBBox(),t=this.paper.text(bb.x,bb.y,p.label),tbb=t.getBBox();t.translate(bb.x-tbb.x+p.labelOffsetX,bb.y-tbb.y+p.labelOffsetY);return t;},getPortElement:function(type,index,label){var bb=this.wrapper.getBBox(),p=this.properties;var port=devs.Port.create({label:label,type:type,position:{x:bb.x+((type==="o")?bb.width:0),y:bb.y+p.portsOffsetY*index},radius:p[type+"PortRadius"],attrs:p[type+"PortAttrs"],offsetX:p[type+"PortLabelOffsetX"],offsetY:p[type+"PortLabelOffsetY"]});return port;},port:function(type,label){var el;for(var i=0,l=this.inner.length;i<l;i++){el=this.inner[i];if(el.properties&&label==el.properties.label&&type==el.properties.type){return el;}}
return undefined;},joint:function(oPort,to,iPort,opt){if(!to.port)return undefined;return this.port("o",oPort).joint(to.port("i",iPort),opt);},zoom:function(){}});devs.Port=Element.extend({object:"Port",module:"devs",init:function(properties){var p=this.properties;p.position=properties.position;p.radius=properties.radius;p.attrs=properties.attrs;p.label=properties.label||"";p.offsetX=properties.offsetX||0;p.offsetY=properties.offsetY||0;p.type=properties.type||"i";this.setWrapper(this.paper.circle(p.position.x,p.position.y,p.radius).attr(p.attrs));this.addInner(this.getLabelElement());},getLabelElement:function(){var bb=this.wrapper.getBBox(),p=this.properties,t=this.paper.text(bb.x,bb.y,p.label),tbb=t.getBBox();t.translate(bb.x-tbb.x+p.offsetX,bb.y-tbb.y+p.offsetY);return t;},zoom:function(){}});})(this);/**
 * Joint 0.2 - JavaScript diagramming library.
 * Copyright (c) David Durman 2009 - 2010
 * Licensed under the MIT license: (http://www.opensource.org/licenses/mit-license.php)
 */

(function(global){var arrows=global.Joint.arrows;arrows.hand=function(size){return{path:["M","-15.681352","-5.1927657","C","-15.208304","-5.2925912","-14.311293","-5.5561164","-13.687993","-5.7783788","C","-13.06469","-6.0006406","-12.343434","-6.2537623","-12.085196","-6.3408738","C","-10.972026","-6.7163768","-7.6682017","-8.1305627","-5.9385615","-8.9719142","C","-4.9071402","-9.4736293","-3.9010109","-9.8815423","-3.7027167","-9.8783923","C","-3.5044204","-9.8752373","-2.6780248","-9.5023173","-1.8662751","-9.0496708","C","-0.49317056","-8.2840047","-0.31169266","-8.2208528","0.73932854","-8.142924","L","1.8690327","-8.0591623","L","2.039166","-7.4474021","C","2.1327395","-7.1109323","2.1514594","-6.8205328","2.0807586","-6.8020721","C","2.010064","-6.783614","1.3825264","-6.7940997","0.68622374","-6.8253794","C","-0.66190616","-6.8859445","-1.1814444","-6.8071497","-1.0407498","-6.5634547","C","-0.99301966","-6.4807831","-0.58251196","-6.4431792","-0.12850911","-6.4798929","C","1.2241412","-6.5892761","4.7877672","-6.1187783","8.420785","-5.3511477","C","14.547755","-4.056566","16.233479","-2.9820024","15.666933","-0.73209438","C","15.450654","0.12678873","14.920327","0.61899573","14.057658","0.76150753","C","13.507869","0.85232533","12.818867","0.71394493","9.8149232","-0.090643373","C","7.4172698","-0.73284018","6.1067424","-1.0191399","5.8609814","-0.95442248","C","5.6587992","-0.90118658","4.8309652","-0.89582008","4.0213424","-0.94250688","C","3.0856752","-0.99645868","2.5291546","-0.95219288","2.4940055","-0.82101488","C","2.4635907","-0.70750508","2.4568664","-0.61069078","2.4790596","-0.60585818","C","2.5012534","-0.60103228","2.9422761","-0.59725718","3.4591019","-0.59747878","C","3.9759261","-0.59770008","4.4500472","-0.58505968","4.512693","-0.56939128","C","4.7453841","-0.51117988","4.6195024","0.92436343","4.318067","1.650062","C","3.8772746","2.7112738","2.9836566","3.9064107","2.2797382","4.3761637","C","1.5987482","4.8306065","1.52359","4.9484512","1.8576616","5.0379653","C","1.9860795","5.0723748","2.2155555","4.9678227","2.3676284","4.8056312","C","2.6253563","4.5307504","2.6497332","4.5328675","2.7268401","4.8368824","C","2.8605098","5.3638848","2.3264901","6.4808604","1.6782299","7.0301956","C","1.3498639","7.30845","0.75844624","8.0404548","0.36396655","8.6568609","C","-0.58027706","10.132325","-0.69217806","10.238528","-1.4487256","10.377186","C","-2.2048498","10.515767","-4.6836995","9.9021604","-6.41268","9.1484214","C","-9.9464649","7.6078865","-10.697587","7.3186028","-12.142194","6.9417312","C","-13.020384","6.712621","-14.184145","6.4654454","-14.72833","6.3924328","C","-15.272516","6.3194263","-15.731691","6.241583","-15.748724","6.2194535","C","-15.813855","6.1348086","-16.609132","-4.7586323","-16.562804","-4.9315285","C","-16.551052","-4.9753876","-16.154402","-5.0929474","-15.681351","-5.192769","L","-15.681352","-5.1927657","z","M","11.288619","-1.446424","L","10.957631","-0.2111606","L","11.627189","-0.031753373","C","13.374637","0.43647423","14.580622","0.18262123","15.042031","-0.75056578","C","15.503958","-1.6847955","14.648263","-2.6070187","12.514834","-3.4742549","L","11.634779","-3.8320046","L","11.627191","-3.2568392","C","11.623019","-2.9405087","11.470661","-2.1258178","11.288619","-1.446424","z"],dx:17,dy:17,attrs:{fill:"white"}};};arrows.flower=function(size){return{path:["M","14.407634","0.14101164","C","13.49394","-0.67828198","12.640683","-1.3981484","11.695412","-1.9684748","C","9.0580339","-3.5615387","6.1975385","-4.0965167","3.8809003","-3.2050972","C","-1.0202735","-1.4355585","-2.2650956","-0.75266958","-6.1678175","-0.75266958","L","-6.1678175","-2.0100414","C","-1.8745566","-2.0888183","1.0024122","-3.7090503","1.8649218","-6.1147565","C","2.2734082","-7.1733737","2.0690534","-8.5444386","0.7737959","-9.8037723","C","-0.82956951","-11.36162","-5.2455289","-11.821547","-6.0950803","-7.2474282","C","-5.3751604","-7.7316963","-3.8041596","-7.6860056","-3.2477662","-6.7174716","C","-2.8775009","-5.9772878","-3.0228781","-5.1443269","-3.3412911","-4.7534348","C","-3.7218578","-4.1236184","-4.935379","-3.5168459","-6.1678175","-3.5168459","L","-6.1678175","-5.6886834","L","-8.5890734","-5.6886834","L","-8.5890734","-1.1787104","C","-9.8368017","-1.2379009","-10.838424","-1.918296","-11.394817","-3.1843135","C","-11.92063","-3.0214395","-12.984452","-2.2582108","-12.911997","-1.2099015","C","-14.045721","-1.0028338","-14.687381","-0.80225028","-15.717737","0.14101164","C","-14.687714","1.0836088","-14.046053","1.2744822","-12.911997","1.4815506","C","-12.984786","2.5298263","-11.92063","3.2930879","-11.394817","3.4559626","C","-10.838424","2.1902771","-9.8368017","1.5095164","-8.5890734","1.4503588","L","-8.5890734","5.9603315","L","-6.1678175","5.9603315","L","-6.1678175","3.788495","C","-4.935379","3.788495","-3.7218578","4.3958989","-3.3412911","5.0250837","C","-3.0228781","5.4159757","-2.8775009","6.2482381","-3.2477662","6.9891209","C","-3.8041596","7.9569902","-5.3751604","8.003345","-6.0950803","7.5190778","C","-5.2455353","12.093197","-0.82956631","11.643978","0.7737959","10.08583","C","2.0693864","8.827128","2.2734082","7.4453226","1.8649218","6.3864056","C","1.00208","3.980998","-1.8745566","2.3705098","-6.1678175","2.2920986","L","-6.1678175","1.0243179","C","-2.2650956","1.0243179","-1.0206064","1.7065088","3.8809003","3.4767455","C","6.1975385","4.367168","9.0580339","3.8331873","11.695412","2.2401238","C","12.640683","1.669431","13.493608","0.95964074","14.407634","0.14101164","z"],dx:15,dy:15,attrs:{fill:"white"}};};arrows.rect=function(size){return{path:["M","15","5","L","-15","5","L","-15","-5","L","15","-5","z"],dx:15,dy:15,attrs:{stroke:"black","stroke-width":1.0}};};})(this);/**
 * Joint 0.2 - JavaScript diagramming library.
 * Copyright (c) David Durman 2009 - 2010
 * Licensed under the MIT license: (http://www.opensource.org/licenses/mit-license.php)
 */

(function(global){var Joint=global.Joint;Joint.Mixin(Joint.prototype,{compact:function(){var start=this.startObject(),end=this.endObject(),regs=this._registeredObjects,iRegs=regs.length,reg,j={object:"joint",euid:this.euid(),opt:this._opt,from:undefined,to:undefined,registered:{start:[],end:[],both:[]}};if(start.wholeShape)
j.from=start.wholeShape.euid();if(end.wholeShape)
j.to=end.wholeShape.euid();if(this.isStartDummy())
j.from=start.attrs.cx+"@"+start.attrs.cy;if(this.isEndDummy())
j.to=end.attrs.cx+"@"+end.attrs.cy;while(iRegs--){reg=regs[iRegs];j.registered[reg._capToStick||"both"].push(reg.euid());}
return j;},stringify:function(){return JSON.stringify(this.compact());}});Joint.Mixin(Joint.dia,{clone:function(){return this.parse(this.stringify(Joint.paper()));},parse:function(json){var arr=JSON.parse(json),o,m,e,element,joints=[],i,len,elements={},objects=[];if(!(arr instanceof Array))arr=[arr];for(i=0,len=arr.length;i<len;i++){o=arr[i];m=o.module;e=o.object;if(e==="joint"){joints.push(o);objects.push(o);continue;}
if(this[m]){if(this[m][e]){element=this[m][e].create(o);}else{console.error("Object "+e+" of module "+m+" is missing.");return;}}else{console.error("Module "+m+" is missing.");return;}
if(o.euid)elements[o.euid]=element;element.translate(o.dx,o.dy);element.scale(o.sx,o.sy);objects.push(element);}
this.hierarchize(elements);this.createJoints(joints,elements);return objects;},hierarchize:function(elements){var euid,element;for(euid in elements){if(!elements.hasOwnProperty(euid))continue;element=elements[euid];if(element.properties.parent&&elements[element.properties.parent])
elements[element.properties.parent].addInner(element);}},createJoints:function(joints,elements){var iJoints=joints.length,joint,from,to,realFrom,realTo,newJoint,toRegister,toRegisterElement,iRegister,cap,sides=["start","end","both"],iSides=sides.length;while(iJoints--){joint=joints[iJoints];from=elements[joint.from];to=elements[joint.to];realFrom=(from)?from.wrapper:{x:joint.from.split("@")[0],y:joint.from.split("@")[1]};realTo=(to)?to.wrapper:{x:joint.to.split("@")[0],y:joint.to.split("@")[1]};newJoint=this.Joint(realFrom,realTo,joint.opt);toRegister=[];iSides=sides.length;while(iSides--){cap=sides[iSides];iRegister=joint.registered[cap].length;while(iRegister--){if(elements[joint.registered[cap][iRegister]]){toRegisterElement=elements[joint.registered[cap][iRegister]];toRegisterElement._capToStick=cap;toRegister.push(toRegisterElement);}}}
newJoint.registerForever(toRegister);}},stringify:function(paper){var objs,iObjs,o,str=[],registeredObjects=this._registeredObjects,registeredJoints=this._registeredJoints,paperEuid=paper.euid();if(registeredObjects[paperEuid]){objs=registeredObjects[paperEuid];iObjs=objs.length;while(iObjs--){o=objs[iObjs];if(o.object)
str.push(o.stringify());}}
if(registeredJoints[paperEuid]){objs=registeredJoints[paperEuid];iObjs=objs.length;while(iObjs--){o=objs[iObjs];str.push(o.stringify());}}
return"["+str.join(",")+"]";}});Joint.Mixin(Joint.dia.Element.prototype,{stringify:function(){return JSON.stringify(Joint.Mixin(this.properties,{euid:this.euid()}));},clone:function(){return Joint.dia.parse(this.stringify())[0];}});})(this);